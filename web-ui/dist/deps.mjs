var ra,w,Xa,ua,W,Ga,Za,al,ll,ya,ka,fa,rl,la={},el=[],cr=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ea=Array.isArray;function U(a,l){for(var r in l)a[r]=l[r];return a}function _a(a){a&&a.parentNode&&a.parentNode.removeChild(a)}function j(a,l,r){var e,t,i,n={};for(i in l)i=="key"?e=l[i]:i=="ref"?t=l[i]:n[i]=l[i];if(arguments.length>2&&(n.children=arguments.length>3?ra.call(arguments,2):r),typeof a=="function"&&a.defaultProps!=null)for(i in a.defaultProps)n[i]===void 0&&(n[i]=a.defaultProps[i]);return Z(a,n,e,t,null)}function Z(a,l,r,e,t){var i={type:a,props:l,key:r,ref:e,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:t??++Xa,__i:-1,__u:0};return t==null&&w.vnode!=null&&w.vnode(i),i}function ye(){return{current:null}}function G(a){return a.children}function aa(a,l){this.props=a,this.context=l}function V(a,l){if(l==null)return a.__?V(a.__,a.__i+1):null;for(var r;l<a.__k.length;l++)if((r=a.__k[l])!=null&&r.__e!=null)return r.__e;return typeof a.type=="function"?V(a):null}function tl(a){var l,r;if((a=a.__)!=null&&a.__c!=null){for(a.__e=a.__c.base=null,l=0;l<a.__k.length;l++)if((r=a.__k[l])!=null&&r.__e!=null){a.__e=a.__c.base=r.__e;break}return tl(a)}}function wa(a){(!a.__d&&(a.__d=!0)&&W.push(a)&&!ma.__r++||Ga!=w.debounceRendering)&&((Ga=w.debounceRendering)||Za)(ma)}function ma(){for(var a,l,r,e,t,i,n,s=1;W.length;)W.length>s&&W.sort(al),a=W.shift(),s=W.length,a.__d&&(r=void 0,t=(e=(l=a).__v).__e,i=[],n=[],l.__P&&((r=U({},e)).__v=e.__v+1,w.vnode&&w.vnode(r),Sa(l.__P,r,e,l.__n,l.__P.namespaceURI,32&e.__u?[t]:null,i,t??V(e),!!(32&e.__u),n),r.__v=e.__v,r.__.__k[r.__i]=r,sl(i,r,n),r.__e!=t&&tl(r)));ma.__r=0}function il(a,l,r,e,t,i,n,s,u,o,b){var m,c,v,k,_,h,p,d=e&&e.__k||el,z=l.length;for(u=vr(r,l,d,u,z),m=0;m<z;m++)(v=r.__k[m])!=null&&(c=v.__i==-1?la:d[v.__i]||la,v.__i=m,h=Sa(a,v,c,t,i,n,s,u,o,b),k=v.__e,v.ref&&c.ref!=v.ref&&(c.ref&&za(c.ref,null,v),b.push(v.ref,v.__c||k,v)),_==null&&k!=null&&(_=k),(p=!!(4&v.__u))||c.__k===v.__k?u=nl(v,u,a,p):typeof v.type=="function"&&h!==void 0?u=h:k&&(u=k.nextSibling),v.__u&=-7);return r.__e=_,u}function vr(a,l,r,e,t){var i,n,s,u,o,b=r.length,m=b,c=0;for(a.__k=new Array(t),i=0;i<t;i++)(n=l[i])!=null&&typeof n!="boolean"&&typeof n!="function"?(u=i+c,(n=a.__k[i]=typeof n=="string"||typeof n=="number"||typeof n=="bigint"||n.constructor==String?Z(null,n,null,null,null):ea(n)?Z(G,{children:n},null,null,null):n.constructor==null&&n.__b>0?Z(n.type,n.props,n.key,n.ref?n.ref:null,n.__v):n).__=a,n.__b=a.__b+1,s=null,(o=n.__i=dr(n,r,u,m))!=-1&&(m--,(s=r[o])&&(s.__u|=2)),s==null||s.__v==null?(o==-1&&(t>b?c--:t<b&&c++),typeof n.type!="function"&&(n.__u|=4)):o!=u&&(o==u-1?c--:o==u+1?c++:(o>u?c--:c++,n.__u|=4))):a.__k[i]=null;if(m)for(i=0;i<b;i++)(s=r[i])!=null&&(2&s.__u)==0&&(s.__e==e&&(e=V(s)),ml(s,s));return e}function nl(a,l,r,e){var t,i;if(typeof a.type=="function"){for(t=a.__k,i=0;t&&i<t.length;i++)t[i]&&(t[i].__=a,l=nl(t[i],l,r,e));return l}a.__e!=l&&(e&&(l&&a.type&&!l.parentNode&&(l=V(a)),r.insertBefore(a.__e,l||null)),l=a.__e);do l=l&&l.nextSibling;while(l!=null&&l.nodeType==8);return l}function hr(a,l){return l=l||[],a==null||typeof a=="boolean"||(ea(a)?a.some(function(r){hr(r,l)}):l.push(a)),l}function dr(a,l,r,e){var t,i,n,s=a.key,u=a.type,o=l[r],b=o!=null&&(2&o.__u)==0;if(o===null&&a.key==null||b&&s==o.key&&u==o.type)return r;if(e>(b?1:0)){for(t=r-1,i=r+1;t>=0||i<l.length;)if((o=l[n=t>=0?t--:i++])!=null&&(2&o.__u)==0&&s==o.key&&u==o.type)return n}return-1}function Ya(a,l,r){l[0]=="-"?a.setProperty(l,r??""):a[l]=r==null?"":typeof r!="number"||cr.test(l)?r:r+"px"}function oa(a,l,r,e,t){var i,n;a:if(l=="style")if(typeof r=="string")a.style.cssText=r;else{if(typeof e=="string"&&(a.style.cssText=e=""),e)for(l in e)r&&l in r||Ya(a.style,l,"");if(r)for(l in r)e&&r[l]==e[l]||Ya(a.style,l,r[l])}else if(l[0]=="o"&&l[1]=="n")i=l!=(l=l.replace(ll,"$1")),n=l.toLowerCase(),l=n in a||l=="onFocusOut"||l=="onFocusIn"?n.slice(2):l.slice(2),a.l||(a.l={}),a.l[l+i]=r,r?e?r.u=e.u:(r.u=ya,a.addEventListener(l,i?fa:ka,i)):a.removeEventListener(l,i?fa:ka,i);else{if(t=="http://www.w3.org/2000/svg")l=l.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(l!="width"&&l!="height"&&l!="href"&&l!="list"&&l!="form"&&l!="tabIndex"&&l!="download"&&l!="rowSpan"&&l!="colSpan"&&l!="role"&&l!="popover"&&l in a)try{a[l]=r??"";break a}catch{}typeof r=="function"||(r==null||r===!1&&l[4]!="-"?a.removeAttribute(l):a.setAttribute(l,l=="popover"&&r==1?"":r))}}function Qa(a){return function(l){if(this.l){var r=this.l[l.type+a];if(l.t==null)l.t=ya++;else if(l.t<r.u)return;return r(w.event?w.event(l):l)}}}function Sa(a,l,r,e,t,i,n,s,u,o){var b,m,c,v,k,_,h,p,d,z,E,P,x,I,C,S,D,T=l.type;if(l.constructor!=null)return null;128&r.__u&&(u=!!(32&r.__u),i=[s=l.__e=r.__e]),(b=w.__b)&&b(l);a:if(typeof T=="function")try{if(p=l.props,d="prototype"in T&&T.prototype.render,z=(b=T.contextType)&&e[b.__c],E=b?z?z.props.value:b.__:e,r.__c?h=(m=l.__c=r.__c).__=m.__E:(d?l.__c=m=new T(p,E):(l.__c=m=new aa(p,E),m.constructor=T,m.render=pr),z&&z.sub(m),m.props=p,m.state||(m.state={}),m.context=E,m.__n=e,c=m.__d=!0,m.__h=[],m._sb=[]),d&&m.__s==null&&(m.__s=m.state),d&&T.getDerivedStateFromProps!=null&&(m.__s==m.state&&(m.__s=U({},m.__s)),U(m.__s,T.getDerivedStateFromProps(p,m.__s))),v=m.props,k=m.state,m.__v=l,c)d&&T.getDerivedStateFromProps==null&&m.componentWillMount!=null&&m.componentWillMount(),d&&m.componentDidMount!=null&&m.__h.push(m.componentDidMount);else{if(d&&T.getDerivedStateFromProps==null&&p!==v&&m.componentWillReceiveProps!=null&&m.componentWillReceiveProps(p,E),!m.__e&&m.shouldComponentUpdate!=null&&m.shouldComponentUpdate(p,m.__s,E)===!1||l.__v==r.__v){for(l.__v!=r.__v&&(m.props=p,m.state=m.__s,m.__d=!1),l.__e=r.__e,l.__k=r.__k,l.__k.some(function(L){L&&(L.__=l)}),P=0;P<m._sb.length;P++)m.__h.push(m._sb[P]);m._sb=[],m.__h.length&&n.push(m);break a}m.componentWillUpdate!=null&&m.componentWillUpdate(p,m.__s,E),d&&m.componentDidUpdate!=null&&m.__h.push(function(){m.componentDidUpdate(v,k,_)})}if(m.context=E,m.props=p,m.__P=a,m.__e=!1,x=w.__r,I=0,d){for(m.state=m.__s,m.__d=!1,x&&x(l),b=m.render(m.props,m.state,m.context),C=0;C<m._sb.length;C++)m.__h.push(m._sb[C]);m._sb=[]}else do m.__d=!1,x&&x(l),b=m.render(m.props,m.state,m.context),m.state=m.__s;while(m.__d&&++I<25);m.state=m.__s,m.getChildContext!=null&&(e=U(U({},e),m.getChildContext())),d&&!c&&m.getSnapshotBeforeUpdate!=null&&(_=m.getSnapshotBeforeUpdate(v,k)),S=b,b!=null&&b.type===G&&b.key==null&&(S=ol(b.props.children)),s=il(a,ea(S)?S:[S],l,r,e,t,i,n,s,u,o),m.base=l.__e,l.__u&=-161,m.__h.length&&n.push(m),h&&(m.__E=m.__=null)}catch(L){if(l.__v=null,u||i!=null)if(L.then){for(l.__u|=u?160:128;s&&s.nodeType==8&&s.nextSibling;)s=s.nextSibling;i[i.indexOf(s)]=null,l.__e=s}else{for(D=i.length;D--;)_a(i[D]);xa(l)}else l.__e=r.__e,l.__k=r.__k,L.then||xa(l);w.__e(L,l,r)}else i==null&&l.__v==r.__v?(l.__k=r.__k,l.__e=r.__e):s=l.__e=gr(r.__e,l,r,e,t,i,n,u,o);return(b=w.diffed)&&b(l),128&l.__u?void 0:s}function xa(a){a&&a.__c&&(a.__c.__e=!0),a&&a.__k&&a.__k.forEach(xa)}function sl(a,l,r){for(var e=0;e<r.length;e++)za(r[e],r[++e],r[++e]);w.__c&&w.__c(l,a),a.some(function(t){try{a=t.__h,t.__h=[],a.some(function(i){i.call(t)})}catch(i){w.__e(i,t.__v)}})}function ol(a){return typeof a!="object"||a==null||a.__b&&a.__b>0?a:ea(a)?a.map(ol):U({},a)}function gr(a,l,r,e,t,i,n,s,u){var o,b,m,c,v,k,_,h=r.props,p=l.props,d=l.type;if(d=="svg"?t="http://www.w3.org/2000/svg":d=="math"?t="http://www.w3.org/1998/Math/MathML":t||(t="http://www.w3.org/1999/xhtml"),i!=null){for(o=0;o<i.length;o++)if((v=i[o])&&"setAttribute"in v==!!d&&(d?v.localName==d:v.nodeType==3)){a=v,i[o]=null;break}}if(a==null){if(d==null)return document.createTextNode(p);a=document.createElementNS(t,d,p.is&&p),s&&(w.__m&&w.__m(l,i),s=!1),i=null}if(d==null)h===p||s&&a.data==p||(a.data=p);else{if(i=i&&ra.call(a.childNodes),h=r.props||la,!s&&i!=null)for(h={},o=0;o<a.attributes.length;o++)h[(v=a.attributes[o]).name]=v.value;for(o in h)if(v=h[o],o!="children"){if(o=="dangerouslySetInnerHTML")m=v;else if(!(o in p)){if(o=="value"&&"defaultValue"in p||o=="checked"&&"defaultChecked"in p)continue;oa(a,o,null,v,t)}}for(o in p)v=p[o],o=="children"?c=v:o=="dangerouslySetInnerHTML"?b=v:o=="value"?k=v:o=="checked"?_=v:s&&typeof v!="function"||h[o]===v||oa(a,o,v,h[o],t);if(b)s||m&&(b.__html==m.__html||b.__html==a.innerHTML)||(a.innerHTML=b.__html),l.__k=[];else if(m&&(a.innerHTML=""),il(l.type=="template"?a.content:a,ea(c)?c:[c],l,r,e,d=="foreignObject"?"http://www.w3.org/1999/xhtml":t,i,n,i?i[0]:r.__k&&V(r,0),s,u),i!=null)for(o=i.length;o--;)_a(i[o]);s||(o="value",d=="progress"&&k==null?a.removeAttribute("value"):k!=null&&(k!==a[o]||d=="progress"&&!k||d=="option"&&k!=h[o])&&oa(a,o,k,h[o],t),o="checked",_!=null&&_!=a[o]&&oa(a,o,_,h[o],t))}return a}function za(a,l,r){try{if(typeof a=="function"){var e=typeof a.__u=="function";e&&a.__u(),e&&l==null||(a.__u=a(l))}else a.current=l}catch(t){w.__e(t,r)}}function ml(a,l,r){var e,t;if(w.unmount&&w.unmount(a),(e=a.ref)&&(e.current&&e.current!=a.__e||za(e,null,l)),(e=a.__c)!=null){if(e.componentWillUnmount)try{e.componentWillUnmount()}catch(i){w.__e(i,l)}e.base=e.__P=null}if(e=a.__k)for(t=0;t<e.length;t++)e[t]&&ml(e[t],l,r||typeof a.type!="function");r||_a(a.__e),a.__c=a.__=a.__e=void 0}function pr(a,l,r){return this.constructor(a,r)}function ul(a,l,r){var e,t,i,n;l==document&&(l=document.documentElement),w.__&&w.__(a,l),t=(e=typeof r=="function")?null:r&&r.__k||l.__k,i=[],n=[],Sa(l,a=(!e&&r||l).__k=j(G,null,[a]),t||la,la,l.namespaceURI,!e&&r?[r]:t?null:l.firstChild?ra.call(l.childNodes):null,i,!e&&r?r:t?t.__e:l.firstChild,e,n),sl(i,a,n)}function kr(a,l){ul(a,l,kr)}function Ea(a,l,r){var e,t,i,n,s=U({},a.props);for(i in a.type&&a.type.defaultProps&&(n=a.type.defaultProps),l)i=="key"?e=l[i]:i=="ref"?t=l[i]:s[i]=l[i]===void 0&&n!=null?n[i]:l[i];return arguments.length>2&&(s.children=arguments.length>3?ra.call(arguments,2):r),Z(a.type,s,e||a.key,t||a.ref,null)}function Pa(a){function l(r){var e,t;return this.getChildContext||(e=new Set,(t={})[l.__c]=this,this.getChildContext=function(){return t},this.componentWillUnmount=function(){e=null},this.shouldComponentUpdate=function(i){this.props.value!=i.value&&e.forEach(function(n){n.__e=!0,wa(n)})},this.sub=function(i){e.add(i);var n=i.componentWillUnmount;i.componentWillUnmount=function(){e&&e.delete(i),n&&n.call(i)}}),r.children}return l.__c="__cC"+rl++,l.__=a,l.Provider=l.__l=(l.Consumer=function(r,e){return r.children(e)}).contextType=l,l}ra=el.slice,w={__e:function(a,l,r,e){for(var t,i,n;l=l.__;)if((t=l.__c)&&!t.__)try{if((i=t.constructor)&&i.getDerivedStateFromError!=null&&(t.setState(i.getDerivedStateFromError(a)),n=t.__d),t.componentDidCatch!=null&&(t.componentDidCatch(a,e||{}),n=t.__d),n)return t.__E=t}catch(s){a=s}throw a}},Xa=0,ua=function(a){return a!=null&&a.constructor==null},aa.prototype.setState=function(a,l){var r;r=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=U({},this.state),typeof a=="function"&&(a=a(U({},r),this.props)),a&&U(r,a),a!=null&&this.__v&&(l&&this._sb.push(l),wa(this))},aa.prototype.forceUpdate=function(a){this.__v&&(this.__e=!0,a&&this.__h.push(a),wa(this))},aa.prototype.render=G,W=[],Za=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,al=function(a,l){return a.__v.__b-l.__v.__b},ma.__r=0,ll=/(PointerCapture)$|Capture$/i,ya=0,ka=Qa(!1),fa=Qa(!0),rl=0;var cl=function(a,l,r,e){var t;l[0]=0;for(var i=1;i<l.length;i++){var n=l[i++],s=l[i]?(l[0]|=n?1:2,r[l[i++]]):l[++i];n===3?e[0]=s:n===4?e[1]=Object.assign(e[1]||{},s):n===5?(e[1]=e[1]||{})[l[++i]]=s:n===6?e[1][l[++i]]+=s+"":n?(t=a.apply(s,cl(a,s,r,["",null])),e.push(t),s[0]?l[0]|=2:(l[i-2]=0,l[i]=t)):e.push(s)}return e},bl=new Map;function vl(a){var l=bl.get(this);return l||(l=new Map,bl.set(this,l)),(l=cl(this,l.get(a)||(l.set(a,l=(function(r){for(var e,t,i=1,n="",s="",u=[0],o=function(c){i===1&&(c||(n=n.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?u.push(0,c,n):i===3&&(c||n)?(u.push(3,c,n),i=2):i===2&&n==="..."&&c?u.push(4,c,0):i===2&&n&&!c?u.push(5,0,!0,n):i>=5&&((n||!c&&i===5)&&(u.push(i,0,n,t),i=6),c&&(u.push(i,c,0,t),i=6)),n=""},b=0;b<r.length;b++){b&&(i===1&&o(),o(b));for(var m=0;m<r[b].length;m++)e=r[b][m],i===1?e==="<"?(o(),u=[u],i=3):n+=e:i===4?n==="--"&&e===">"?(i=1,n=""):n=e+n[0]:s?e===s?s="":n+=e:e==='"'||e==="'"?s=e:e===">"?(o(),i=1):i&&(e==="="?(i=5,t=n,n=""):e==="/"&&(i<5||r[b][m+1]===">")?(o(),i===3&&(u=u[0]),i=u,(u=u[0]).push(2,0,i),i=0):e===" "||e==="	"||e===`
`||e==="\r"?(o(),i=2):n+=e),i===3&&n==="!--"&&(i=4,u=u[0])}return o(),u})(a)),l),arguments,[])).length>1?l:l[0]}var Re=vl.bind(j);var N,f,Ca,hl,Y=0,yl=[],y=w,dl=y.__b,gl=y.__r,pl=y.diffed,kl=y.__c,fl=y.unmount,wl=y.__;function K(a,l){y.__h&&y.__h(f,a,Y||l),Y=0;var r=f.__H||(f.__H={__:[],__h:[]});return a>=r.__.length&&r.__.push({}),r.__[a]}function Ta(a){return Y=1,fr(Sl,a)}function fr(a,l,r){var e=K(N++,2);if(e.t=a,!e.__c&&(e.__=[r?r(l):Sl(void 0,l),function(s){var u=e.__N?e.__N[0]:e.__[0],o=e.t(u,s);u!==o&&(e.__N=[o,e.__[1]],e.__c.setState({}))}],e.__c=f,!f.__f)){var t=function(s,u,o){if(!e.__c.__H)return!0;var b=e.__c.__H.__.filter(function(c){return!!c.__c});if(b.every(function(c){return!c.__N}))return!i||i.call(this,s,u,o);var m=e.__c.props!==s;return b.forEach(function(c){if(c.__N){var v=c.__[0];c.__=c.__N,c.__N=void 0,v!==c.__[0]&&(m=!0)}}),i&&i.call(this,s,u,o)||m};f.__f=!0;var i=f.shouldComponentUpdate,n=f.componentWillUpdate;f.componentWillUpdate=function(s,u,o){if(this.__e){var b=i;i=void 0,t(s,u,o),i=b}n&&n.call(this,s,u,o)},f.shouldComponentUpdate=t}return e.__N||e.__}function _l(a,l){var r=K(N++,3);!y.__s&&Ua(r.__H,l)&&(r.__=a,r.u=l,f.__H.__h.push(r))}function Q(a,l){var r=K(N++,4);!y.__s&&Ua(r.__H,l)&&(r.__=a,r.u=l,f.__h.push(r))}function ta(a){return Y=5,ca(function(){return{current:a}},[])}function je(a,l,r){Y=6,Q(function(){if(typeof a=="function"){var e=a(l());return function(){a(null),e&&typeof e=="function"&&e()}}if(a)return a.current=l(),function(){return a.current=null}},r==null?r:r.concat(a))}function ca(a,l){var r=K(N++,7);return Ua(r.__H,l)&&(r.__=a(),r.__H=l,r.__h=a),r.__}function qe(a,l){return Y=8,ca(function(){return a},l)}function Ia(a){var l=f.context[a.__c],r=K(N++,9);return r.c=a,l?(r.__==null&&(r.__=!0,l.sub(f)),l.props.value):a.__}function Ae(a,l){y.useDebugValue&&y.useDebugValue(l?l(a):a)}function Oe(a){var l=K(N++,10),r=Ta();return l.__=a,f.componentDidCatch||(f.componentDidCatch=function(e,t){l.__&&l.__(e,t),r[1](e)}),[r[0],function(){r[1](void 0)}]}function He(){var a=K(N++,11);if(!a.__){for(var l=f.__v;l!==null&&!l.__m&&l.__!==null;)l=l.__;var r=l.__m||(l.__m=[0,0]);a.__="P"+r[0]+"-"+r[1]++}return a.__}function wr(){for(var a;a=yl.shift();)if(a.__P&&a.__H)try{a.__H.__h.forEach(ba),a.__H.__h.forEach(Ra),a.__H.__h=[]}catch(l){a.__H.__h=[],y.__e(l,a.__v)}}y.__b=function(a){f=null,dl&&dl(a)},y.__=function(a,l){a&&l.__k&&l.__k.__m&&(a.__m=l.__k.__m),wl&&wl(a,l)},y.__r=function(a){gl&&gl(a),N=0;var l=(f=a.__c).__H;l&&(Ca===f?(l.__h=[],f.__h=[],l.__.forEach(function(r){r.__N&&(r.__=r.__N),r.u=r.__N=void 0})):(l.__h.forEach(ba),l.__h.forEach(Ra),l.__h=[],N=0)),Ca=f},y.diffed=function(a){pl&&pl(a);var l=a.__c;l&&l.__H&&(l.__H.__h.length&&(yl.push(l)!==1&&hl===y.requestAnimationFrame||((hl=y.requestAnimationFrame)||xr)(wr)),l.__H.__.forEach(function(r){r.u&&(r.__H=r.u),r.u=void 0})),Ca=f=null},y.__c=function(a,l){l.some(function(r){try{r.__h.forEach(ba),r.__h=r.__h.filter(function(e){return!e.__||Ra(e)})}catch(e){l.some(function(t){t.__h&&(t.__h=[])}),l=[],y.__e(e,r.__v)}}),kl&&kl(a,l)},y.unmount=function(a){fl&&fl(a);var l,r=a.__c;r&&r.__H&&(r.__H.__.forEach(function(e){try{ba(e)}catch(t){l=t}}),r.__H=void 0,l&&y.__e(l,r.__v))};var xl=typeof requestAnimationFrame=="function";function xr(a){var l,r=function(){clearTimeout(e),xl&&cancelAnimationFrame(l),setTimeout(a)},e=setTimeout(r,35);xl&&(l=requestAnimationFrame(r))}function ba(a){var l=f,r=a.__c;typeof r=="function"&&(a.__c=void 0,r()),f=l}function Ra(a){var l=f;a.__c=a.__(),f=l}function Ua(a,l){return!a||a.length!==l.length||l.some(function(r,e){return r!==a[e]})}function Sl(a,l){return typeof l=="function"?l(a):l}var J=class extends Error{};J.prototype.name="InvalidTokenError";function yr(a){return decodeURIComponent(atob(a).replace(/(.)/g,(l,r)=>{let e=r.charCodeAt(0).toString(16).toUpperCase();return e.length<2&&(e="0"+e),"%"+e}))}function _r(a){let l=a.replace(/-/g,"+").replace(/_/g,"/");switch(l.length%4){case 0:break;case 2:l+="==";break;case 3:l+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return yr(l)}catch{return atob(l)}}function zl(a,l){if(typeof a!="string")throw new J("Invalid token specified: must be a string");l||(l={});let r=l.header===!0?0:1,e=a.split(".")[r];if(typeof e!="string")throw new J(`Invalid token specified: missing part #${r+1}`);let t;try{t=_r(e)}catch(i){throw new J(`Invalid token specified: invalid base64 for part #${r+1} (${i.message})`)}try{return JSON.parse(t)}catch(i){throw new J(`Invalid token specified: invalid json for part #${r+1} (${i.message})`)}}var Sr={debug:()=>{},info:()=>{},warn:()=>{},error:()=>{}},O,H,ha=(a=>(a[a.NONE=0]="NONE",a[a.ERROR=1]="ERROR",a[a.WARN=2]="WARN",a[a.INFO=3]="INFO",a[a.DEBUG=4]="DEBUG",a))(ha||{});(a=>{function l(){O=3,H=Sr}a.reset=l;function r(t){if(!(0<=t&&t<=4))throw new Error("Invalid log level");O=t}a.setLevel=r;function e(t){H=t}a.setLogger=e})(ha||(ha={}));var g=class q{constructor(l){this._name=l}debug(...l){O>=4&&H.debug(q._format(this._name,this._method),...l)}info(...l){O>=3&&H.info(q._format(this._name,this._method),...l)}warn(...l){O>=2&&H.warn(q._format(this._name,this._method),...l)}error(...l){O>=1&&H.error(q._format(this._name,this._method),...l)}throw(l){throw this.error(l),l}create(l){let r=Object.create(this);return r._method=l,r.debug("begin"),r}static createStatic(l,r){let e=new q(`${l}.${r}`);return e.debug("begin"),e}static _format(l,r){let e=`[${l}]`;return r?`${e} ${r}:`:e}static debug(l,...r){O>=4&&H.debug(q._format(l),...r)}static info(l,...r){O>=3&&H.info(q._format(l),...r)}static warn(l,...r){O>=2&&H.warn(q._format(l),...r)}static error(l,...r){O>=1&&H.error(q._format(l),...r)}};ha.reset();var da=class{static decode(a){try{return zl(a)}catch(l){throw g.error("JwtUtils.decode",l),l}}static async generateSignedJwt(a,l,r){let e=R.encodeBase64Url(new TextEncoder().encode(JSON.stringify(a))),t=R.encodeBase64Url(new TextEncoder().encode(JSON.stringify(l))),i=`${e}.${t}`,n=await window.crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},r,new TextEncoder().encode(i)),s=R.encodeBase64Url(new Uint8Array(n));return`${i}.${s}`}},zr="10000000-1000-4000-8000-100000000000",Aa=a=>btoa([...new Uint8Array(a)].map(l=>String.fromCharCode(l)).join("")),Tl=class A{static _randomWord(){let l=new Uint32Array(1);return crypto.getRandomValues(l),l[0]}static generateUUIDv4(){return zr.replace(/[018]/g,r=>(+r^A._randomWord()&15>>+r/4).toString(16)).replace(/-/g,"")}static generateCodeVerifier(){return A.generateUUIDv4()+A.generateUUIDv4()+A.generateUUIDv4()}static async generateCodeChallenge(l){if(!crypto.subtle)throw new Error("Crypto.subtle is available only in secure contexts (HTTPS).");try{let e=new TextEncoder().encode(l),t=await crypto.subtle.digest("SHA-256",e);return Aa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}catch(r){throw g.error("CryptoUtils.generateCodeChallenge",r),r}}static generateBasicAuth(l,r){let t=new TextEncoder().encode([l,r].join(":"));return Aa(t)}static async hash(l,r){let e=new TextEncoder().encode(r),t=await crypto.subtle.digest(l,e);return new Uint8Array(t)}static async customCalculateJwkThumbprint(l){let r;switch(l.kty){case"RSA":r={e:l.e,kty:l.kty,n:l.n};break;case"EC":r={crv:l.crv,kty:l.kty,x:l.x,y:l.y};break;case"OKP":r={crv:l.crv,kty:l.kty,x:l.x};break;case"oct":r={crv:l.k,kty:l.kty};break;default:throw new Error("Unknown jwk type")}let e=await A.hash("SHA-256",JSON.stringify(r));return A.encodeBase64Url(e)}static async generateDPoPProof({url:l,accessToken:r,httpMethod:e,keyPair:t,nonce:i}){let n,s,u={jti:window.crypto.randomUUID(),htm:e??"GET",htu:l,iat:Math.floor(Date.now()/1e3)};r&&(n=await A.hash("SHA-256",r),s=A.encodeBase64Url(n),u.ath=s),i&&(u.nonce=i);try{let o=await crypto.subtle.exportKey("jwk",t.publicKey),b={alg:"ES256",typ:"dpop+jwt",jwk:{crv:o.crv,kty:o.kty,x:o.x,y:o.y}};return await da.generateSignedJwt(b,u,t.privateKey)}catch(o){throw o instanceof TypeError?new Error(`Error exporting dpop public key: ${o.message}`):o}}static async generateDPoPJkt(l){try{let r=await crypto.subtle.exportKey("jwk",l.publicKey);return await A.customCalculateJwkThumbprint(r)}catch(r){throw r instanceof TypeError?new Error(`Could not retrieve dpop keys from storage: ${r.message}`):r}}static async generateDPoPKeys(){return await window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!1,["sign","verify"])}};Tl.encodeBase64Url=a=>Aa(a).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");var R=Tl,$=class{constructor(a){this._name=a,this._callbacks=[],this._logger=new g(`Event('${this._name}')`)}addHandler(a){return this._callbacks.push(a),()=>this.removeHandler(a)}removeHandler(a){let l=this._callbacks.lastIndexOf(a);l>=0&&this._callbacks.splice(l,1)}async raise(...a){this._logger.debug("raise:",...a);for(let l of this._callbacks)await l(...a)}},El=class{static center({...a}){var l,r,e;return a.width==null&&(a.width=(l=[800,720,600,480].find(t=>t<=window.outerWidth/1.618))!=null?l:360),(r=a.left)!=null||(a.left=Math.max(0,Math.round(window.screenX+(window.outerWidth-a.width)/2))),a.height!=null&&((e=a.top)!=null||(a.top=Math.max(0,Math.round(window.screenY+(window.outerHeight-a.height)/2)))),a}static serialize(a){return Object.entries(a).filter(([,l])=>l!=null).map(([l,r])=>`${l}=${typeof r!="boolean"?r:r?"yes":"no"}`).join(",")}},M=class va extends ${constructor(){super(...arguments),this._logger=new g(`Timer('${this._name}')`),this._timerHandle=null,this._expiration=0,this._callback=()=>{let l=this._expiration-va.getEpochTime();this._logger.debug("timer completes in",l),this._expiration<=va.getEpochTime()&&(this.cancel(),super.raise())}}static getEpochTime(){return Math.floor(Date.now()/1e3)}init(l){let r=this._logger.create("init");l=Math.max(Math.floor(l),1);let e=va.getEpochTime()+l;if(this.expiration===e&&this._timerHandle){r.debug("skipping since already initialized for expiration at",this.expiration);return}this.cancel(),r.debug("using duration",l),this._expiration=e;let t=Math.min(l,5);this._timerHandle=setInterval(this._callback,t*1e3)}get expiration(){return this._expiration}cancel(){this._logger.create("cancel"),this._timerHandle&&(clearInterval(this._timerHandle),this._timerHandle=null)}},Oa=class{static readParams(a,l="query"){if(!a)throw new TypeError("Invalid URL");let e=new URL(a,"http://127.0.0.1")[l==="fragment"?"hash":"search"];return new URLSearchParams(e.slice(1))}},X=";",B=class extends Error{constructor(a,l){var r,e,t;if(super(a.error_description||a.error||""),this.form=l,this.name="ErrorResponse",!a.error)throw g.error("ErrorResponse","No error passed"),new Error("No error passed");this.error=a.error,this.error_description=(r=a.error_description)!=null?r:null,this.error_uri=(e=a.error_uri)!=null?e:null,this.state=a.userState,this.session_state=(t=a.session_state)!=null?t:null,this.url_state=a.url_state}},La=class extends Error{constructor(a){super(a),this.name="ErrorTimeout"}},Er=class{constructor(a){this._logger=new g("AccessTokenEvents"),this._expiringTimer=new M("Access token expiring"),this._expiredTimer=new M("Access token expired"),this._expiringNotificationTimeInSeconds=a.expiringNotificationTimeInSeconds}async load(a){let l=this._logger.create("load");if(a.access_token&&a.expires_in!==void 0){let r=a.expires_in;if(l.debug("access token present, remaining duration:",r),r>0){let t=r-this._expiringNotificationTimeInSeconds;t<=0&&(t=1),l.debug("registering expiring timer, raising in",t,"seconds"),this._expiringTimer.init(t)}else l.debug("canceling existing expiring timer because we're past expiration."),this._expiringTimer.cancel();let e=r+1;l.debug("registering expired timer, raising in",e,"seconds"),this._expiredTimer.init(e)}else this._expiringTimer.cancel(),this._expiredTimer.cancel()}async unload(){this._logger.debug("unload: canceling existing access token timers"),this._expiringTimer.cancel(),this._expiredTimer.cancel()}addAccessTokenExpiring(a){return this._expiringTimer.addHandler(a)}removeAccessTokenExpiring(a){this._expiringTimer.removeHandler(a)}addAccessTokenExpired(a){return this._expiredTimer.addHandler(a)}removeAccessTokenExpired(a){this._expiredTimer.removeHandler(a)}},Pr=class{constructor(a,l,r,e,t){this._callback=a,this._client_id=l,this._intervalInSeconds=e,this._stopOnError=t,this._logger=new g("CheckSessionIFrame"),this._timer=null,this._session_state=null,this._message=n=>{n.origin===this._frame_origin&&n.source===this._frame.contentWindow&&(n.data==="error"?(this._logger.error("error message from check session op iframe"),this._stopOnError&&this.stop()):n.data==="changed"?(this._logger.debug("changed message from check session op iframe"),this.stop(),this._callback()):this._logger.debug(n.data+" message from check session op iframe"))};let i=new URL(r);this._frame_origin=i.origin,this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="fixed",this._frame.style.left="-1000px",this._frame.style.top="0",this._frame.width="0",this._frame.height="0",this._frame.src=i.href}load(){return new Promise(a=>{this._frame.onload=()=>{a()},window.document.body.appendChild(this._frame),window.addEventListener("message",this._message,!1)})}start(a){if(this._session_state===a)return;this._logger.create("start"),this.stop(),this._session_state=a;let l=()=>{!this._frame.contentWindow||!this._session_state||this._frame.contentWindow.postMessage(this._client_id+" "+this._session_state,this._frame_origin)};l(),this._timer=setInterval(l,this._intervalInSeconds*1e3)}stop(){this._logger.create("stop"),this._session_state=null,this._timer&&(clearInterval(this._timer),this._timer=null)}},Il=class{constructor(){this._logger=new g("InMemoryWebStorage"),this._data={}}clear(){this._logger.create("clear"),this._data={}}getItem(a){return this._logger.create(`getItem('${a}')`),this._data[a]}setItem(a,l){this._logger.create(`setItem('${a}')`),this._data[a]=l}removeItem(a){this._logger.create(`removeItem('${a}')`),delete this._data[a]}get length(){return Object.getOwnPropertyNames(this._data).length}key(a){return Object.getOwnPropertyNames(this._data)[a]}},Ha=class extends Error{constructor(a,l){super(l),this.name="ErrorDPoPNonce",this.nonce=a}},$a=class{constructor(a=[],l=null,r={}){this._jwtHandler=l,this._extraHeaders=r,this._logger=new g("JsonService"),this._contentTypes=[],this._contentTypes.push(...a,"application/json"),l&&this._contentTypes.push("application/jwt")}async fetchWithTimeout(a,l={}){let{timeoutInSeconds:r,...e}=l;if(!r)return await fetch(a,e);let t=new AbortController,i=setTimeout(()=>t.abort(),r*1e3);try{return await fetch(a,{...l,signal:t.signal})}catch(n){throw n instanceof DOMException&&n.name==="AbortError"?new La("Network timed out"):n}finally{clearTimeout(i)}}async getJson(a,{token:l,credentials:r,timeoutInSeconds:e}={}){let t=this._logger.create("getJson"),i={Accept:this._contentTypes.join(", ")};l&&(t.debug("token passed, setting Authorization header"),i.Authorization="Bearer "+l),this._appendExtraHeaders(i);let n;try{t.debug("url:",a),n=await this.fetchWithTimeout(a,{method:"GET",headers:i,timeoutInSeconds:e,credentials:r})}catch(o){throw t.error("Network Error"),o}t.debug("HTTP response received, status",n.status);let s=n.headers.get("Content-Type");if(s&&!this._contentTypes.find(o=>s.startsWith(o))&&t.throw(new Error(`Invalid response Content-Type: ${s??"undefined"}, from URL: ${a}`)),n.ok&&this._jwtHandler&&s?.startsWith("application/jwt"))return await this._jwtHandler(await n.text());let u;try{u=await n.json()}catch(o){throw t.error("Error parsing JSON response",o),n.ok?o:new Error(`${n.statusText} (${n.status})`)}if(!n.ok)throw t.error("Error from server:",u),u.error?new B(u):new Error(`${n.statusText} (${n.status}): ${JSON.stringify(u)}`);return u}async postForm(a,{body:l,basicAuth:r,timeoutInSeconds:e,initCredentials:t,extraHeaders:i}){let n=this._logger.create("postForm"),s={Accept:this._contentTypes.join(", "),"Content-Type":"application/x-www-form-urlencoded",...i};r!==void 0&&(s.Authorization="Basic "+r),this._appendExtraHeaders(s);let u;try{n.debug("url:",a),u=await this.fetchWithTimeout(a,{method:"POST",headers:s,body:l,timeoutInSeconds:e,credentials:t})}catch(c){throw n.error("Network error"),c}n.debug("HTTP response received, status",u.status);let o=u.headers.get("Content-Type");if(o&&!this._contentTypes.find(c=>o.startsWith(c)))throw new Error(`Invalid response Content-Type: ${o??"undefined"}, from URL: ${a}`);let b=await u.text(),m={};if(b)try{m=JSON.parse(b)}catch(c){throw n.error("Error parsing JSON response",c),u.ok?c:new Error(`${u.statusText} (${u.status})`)}if(!u.ok){if(n.error("Error from server:",m),u.headers.has("dpop-nonce")){let c=u.headers.get("dpop-nonce");throw new Ha(c,`${JSON.stringify(m)}`)}throw m.error?new B(m,l):new Error(`${u.statusText} (${u.status}): ${JSON.stringify(m)}`)}return m}_appendExtraHeaders(a){let l=this._logger.create("appendExtraHeaders"),r=Object.keys(this._extraHeaders),e=["accept","content-type"],t=["authorization"];r.length!==0&&r.forEach(i=>{if(e.includes(i.toLocaleLowerCase())){l.warn("Protected header could not be set",i,e);return}if(t.includes(i.toLocaleLowerCase())&&Object.keys(a).includes(i)){l.warn("Header could not be overridden",i,t);return}let n=typeof this._extraHeaders[i]=="function"?this._extraHeaders[i]():this._extraHeaders[i];n&&n!==""&&(a[i]=n)})}},Cr=class{constructor(a){this._settings=a,this._logger=new g("MetadataService"),this._signingKeys=null,this._metadata=null,this._metadataUrl=this._settings.metadataUrl,this._jsonService=new $a(["application/jwk-set+json"],null,this._settings.extraHeaders),this._settings.signingKeys&&(this._logger.debug("using signingKeys from settings"),this._signingKeys=this._settings.signingKeys),this._settings.metadata&&(this._logger.debug("using metadata from settings"),this._metadata=this._settings.metadata),this._settings.fetchRequestCredentials&&(this._logger.debug("using fetchRequestCredentials from settings"),this._fetchRequestCredentials=this._settings.fetchRequestCredentials)}resetSigningKeys(){this._signingKeys=null}async getMetadata(){let a=this._logger.create("getMetadata");if(this._metadata)return a.debug("using cached values"),this._metadata;if(!this._metadataUrl)throw a.throw(new Error("No authority or metadataUrl configured on settings")),null;a.debug("getting metadata from",this._metadataUrl);let l=await this._jsonService.getJson(this._metadataUrl,{credentials:this._fetchRequestCredentials,timeoutInSeconds:this._settings.requestTimeoutInSeconds});return a.debug("merging remote JSON with seed metadata"),this._metadata=Object.assign({},l,this._settings.metadataSeed),this._metadata}getIssuer(){return this._getMetadataProperty("issuer")}getAuthorizationEndpoint(){return this._getMetadataProperty("authorization_endpoint")}getUserInfoEndpoint(){return this._getMetadataProperty("userinfo_endpoint")}getTokenEndpoint(a=!0){return this._getMetadataProperty("token_endpoint",a)}getCheckSessionIframe(){return this._getMetadataProperty("check_session_iframe",!0)}getEndSessionEndpoint(){return this._getMetadataProperty("end_session_endpoint",!0)}getRevocationEndpoint(a=!0){return this._getMetadataProperty("revocation_endpoint",a)}getKeysEndpoint(a=!0){return this._getMetadataProperty("jwks_uri",a)}async _getMetadataProperty(a,l=!1){let r=this._logger.create(`_getMetadataProperty('${a}')`),e=await this.getMetadata();if(r.debug("resolved"),e[a]===void 0){if(l===!0){r.warn("Metadata does not contain optional property");return}r.throw(new Error("Metadata does not contain property "+a))}return e[a]}async getSigningKeys(){let a=this._logger.create("getSigningKeys");if(this._signingKeys)return a.debug("returning signingKeys from cache"),this._signingKeys;let l=await this.getKeysEndpoint(!1);a.debug("got jwks_uri",l);let r=await this._jsonService.getJson(l,{timeoutInSeconds:this._settings.requestTimeoutInSeconds});if(a.debug("got key set",r),!Array.isArray(r.keys))throw a.throw(new Error("Missing keys on keyset")),null;return this._signingKeys=r.keys,this._signingKeys}},Ul=class{constructor({prefix:a="oidc.",store:l=localStorage}={}){this._logger=new g("WebStorageStateStore"),this._store=l,this._prefix=a}async set(a,l){this._logger.create(`set('${a}')`),a=this._prefix+a,await this._store.setItem(a,l)}async get(a){return this._logger.create(`get('${a}')`),a=this._prefix+a,await this._store.getItem(a)}async remove(a){this._logger.create(`remove('${a}')`),a=this._prefix+a;let l=await this._store.getItem(a);return await this._store.removeItem(a),l}async getAllKeys(){this._logger.create("getAllKeys");let a=await this._store.length,l=[];for(let r=0;r<a;r++){let e=await this._store.key(r);e&&e.indexOf(this._prefix)===0&&l.push(e.substr(this._prefix.length))}return l}},Rr="code",Tr="openid",Ir="client_secret_post",Ur=900,Na=class{constructor({authority:a,metadataUrl:l,metadata:r,signingKeys:e,metadataSeed:t,client_id:i,client_secret:n,response_type:s=Rr,scope:u=Tr,redirect_uri:o,post_logout_redirect_uri:b,client_authentication:m=Ir,prompt:c,display:v,max_age:k,ui_locales:_,acr_values:h,resource:p,response_mode:d,filterProtocolClaims:z=!0,loadUserInfo:E=!1,requestTimeoutInSeconds:P,staleStateAgeInSeconds:x=Ur,mergeClaimsStrategy:I={array:"replace"},disablePKCE:C=!1,stateStore:S,revokeTokenAdditionalContentTypes:D,fetchRequestCredentials:T,refreshTokenAllowedScope:L,extraQueryParams:nr={},extraTokenParams:sr={},extraHeaders:or={},dpop:mr,omitScopeWhenRequesting:ur=!1}){var Va;if(this.authority=a,l?this.metadataUrl=l:(this.metadataUrl=a,a&&(this.metadataUrl.endsWith("/")||(this.metadataUrl+="/"),this.metadataUrl+=".well-known/openid-configuration")),this.metadata=r,this.metadataSeed=t,this.signingKeys=e,this.client_id=i,this.client_secret=n,this.response_type=s,this.scope=u,this.redirect_uri=o,this.post_logout_redirect_uri=b,this.client_authentication=m,this.prompt=c,this.display=v,this.max_age=k,this.ui_locales=_,this.acr_values=h,this.resource=p,this.response_mode=d,this.filterProtocolClaims=z??!0,this.loadUserInfo=!!E,this.staleStateAgeInSeconds=x,this.mergeClaimsStrategy=I,this.omitScopeWhenRequesting=ur,this.disablePKCE=!!C,this.revokeTokenAdditionalContentTypes=D,this.fetchRequestCredentials=T||"same-origin",this.requestTimeoutInSeconds=P,S)this.stateStore=S;else{let br=typeof window<"u"?window.localStorage:new Il;this.stateStore=new Ul({store:br})}if(this.refreshTokenAllowedScope=L,this.extraQueryParams=nr,this.extraTokenParams=sr,this.extraHeaders=or,this.dpop=mr,this.dpop&&!((Va=this.dpop)!=null&&Va.store))throw new Error("A DPoPStore is required when dpop is enabled")}},jr=class{constructor(a,l){this._settings=a,this._metadataService=l,this._logger=new g("UserInfoService"),this._getClaimsFromJwt=async r=>{let e=this._logger.create("_getClaimsFromJwt");try{let t=da.decode(r);return e.debug("JWT decoding successful"),t}catch(t){throw e.error("Error parsing JWT response"),t}},this._jsonService=new $a(void 0,this._getClaimsFromJwt,this._settings.extraHeaders)}async getClaims(a){let l=this._logger.create("getClaims");a||this._logger.throw(new Error("No token passed"));let r=await this._metadataService.getUserInfoEndpoint();l.debug("got userinfo url",r);let e=await this._jsonService.getJson(r,{token:a,credentials:this._settings.fetchRequestCredentials,timeoutInSeconds:this._settings.requestTimeoutInSeconds});return l.debug("got claims",e),e}},jl=class{constructor(a,l){this._settings=a,this._metadataService=l,this._logger=new g("TokenClient"),this._jsonService=new $a(this._settings.revokeTokenAdditionalContentTypes,null,this._settings.extraHeaders)}async exchangeCode({grant_type:a="authorization_code",redirect_uri:l=this._settings.redirect_uri,client_id:r=this._settings.client_id,client_secret:e=this._settings.client_secret,extraHeaders:t,...i}){let n=this._logger.create("exchangeCode");r||n.throw(new Error("A client_id is required")),l||n.throw(new Error("A redirect_uri is required")),i.code||n.throw(new Error("A code is required"));let s=new URLSearchParams({grant_type:a,redirect_uri:l});for(let[m,c]of Object.entries(i))c!=null&&s.set(m,c);let u;switch(this._settings.client_authentication){case"client_secret_basic":if(e==null)throw n.throw(new Error("A client_secret is required")),null;u=R.generateBasicAuth(r,e);break;case"client_secret_post":s.append("client_id",r),e&&s.append("client_secret",e);break}let o=await this._metadataService.getTokenEndpoint(!1);n.debug("got token endpoint");let b=await this._jsonService.postForm(o,{body:s,basicAuth:u,timeoutInSeconds:this._settings.requestTimeoutInSeconds,initCredentials:this._settings.fetchRequestCredentials,extraHeaders:t});return n.debug("got response"),b}async exchangeCredentials({grant_type:a="password",client_id:l=this._settings.client_id,client_secret:r=this._settings.client_secret,scope:e=this._settings.scope,...t}){let i=this._logger.create("exchangeCredentials");l||i.throw(new Error("A client_id is required"));let n=new URLSearchParams({grant_type:a});this._settings.omitScopeWhenRequesting||n.set("scope",e);for(let[b,m]of Object.entries(t))m!=null&&n.set(b,m);let s;switch(this._settings.client_authentication){case"client_secret_basic":if(r==null)throw i.throw(new Error("A client_secret is required")),null;s=R.generateBasicAuth(l,r);break;case"client_secret_post":n.append("client_id",l),r&&n.append("client_secret",r);break}let u=await this._metadataService.getTokenEndpoint(!1);i.debug("got token endpoint");let o=await this._jsonService.postForm(u,{body:n,basicAuth:s,timeoutInSeconds:this._settings.requestTimeoutInSeconds,initCredentials:this._settings.fetchRequestCredentials});return i.debug("got response"),o}async exchangeRefreshToken({grant_type:a="refresh_token",client_id:l=this._settings.client_id,client_secret:r=this._settings.client_secret,timeoutInSeconds:e,extraHeaders:t,...i}){let n=this._logger.create("exchangeRefreshToken");l||n.throw(new Error("A client_id is required")),i.refresh_token||n.throw(new Error("A refresh_token is required"));let s=new URLSearchParams({grant_type:a});for(let[m,c]of Object.entries(i))Array.isArray(c)?c.forEach(v=>s.append(m,v)):c!=null&&s.set(m,c);let u;switch(this._settings.client_authentication){case"client_secret_basic":if(r==null)throw n.throw(new Error("A client_secret is required")),null;u=R.generateBasicAuth(l,r);break;case"client_secret_post":s.append("client_id",l),r&&s.append("client_secret",r);break}let o=await this._metadataService.getTokenEndpoint(!1);n.debug("got token endpoint");let b=await this._jsonService.postForm(o,{body:s,basicAuth:u,timeoutInSeconds:e,initCredentials:this._settings.fetchRequestCredentials,extraHeaders:t});return n.debug("got response"),b}async revoke(a){var l;let r=this._logger.create("revoke");a.token||r.throw(new Error("A token is required"));let e=await this._metadataService.getRevocationEndpoint(!1);r.debug(`got revocation endpoint, revoking ${(l=a.token_type_hint)!=null?l:"default token type"}`);let t=new URLSearchParams;for(let[i,n]of Object.entries(a))n!=null&&t.set(i,n);t.set("client_id",this._settings.client_id),this._settings.client_secret&&t.set("client_secret",this._settings.client_secret),await this._jsonService.postForm(e,{body:t,timeoutInSeconds:this._settings.requestTimeoutInSeconds}),r.debug("got response")}},qr=class{constructor(a,l,r){this._settings=a,this._metadataService=l,this._claimsService=r,this._logger=new g("ResponseValidator"),this._userInfoService=new jr(this._settings,this._metadataService),this._tokenClient=new jl(this._settings,this._metadataService)}async validateSigninResponse(a,l,r){let e=this._logger.create("validateSigninResponse");this._processSigninState(a,l),e.debug("state processed"),await this._processCode(a,l,r),e.debug("code processed"),a.isOpenId&&this._validateIdTokenAttributes(a),e.debug("tokens validated"),await this._processClaims(a,l?.skipUserInfo,a.isOpenId),e.debug("claims processed")}async validateCredentialsResponse(a,l){let r=this._logger.create("validateCredentialsResponse"),e=a.isOpenId&&!!a.id_token;e&&this._validateIdTokenAttributes(a),r.debug("tokens validated"),await this._processClaims(a,l,e),r.debug("claims processed")}async validateRefreshResponse(a,l){var r,e;let t=this._logger.create("validateRefreshResponse");a.userState=l.data,(r=a.session_state)!=null||(a.session_state=l.session_state),(e=a.scope)!=null||(a.scope=l.scope),a.isOpenId&&a.id_token&&(this._validateIdTokenAttributes(a,l.id_token),t.debug("ID Token validated")),a.id_token||(a.id_token=l.id_token,a.profile=l.profile);let i=a.isOpenId&&!!a.id_token;await this._processClaims(a,!1,i),t.debug("claims processed")}validateSignoutResponse(a,l){let r=this._logger.create("validateSignoutResponse");if(l.id!==a.state&&r.throw(new Error("State does not match")),r.debug("state validated"),a.userState=l.data,a.error)throw r.warn("Response was error",a.error),new B(a)}_processSigninState(a,l){var r;let e=this._logger.create("_processSigninState");if(l.id!==a.state&&e.throw(new Error("State does not match")),l.client_id||e.throw(new Error("No client_id on state")),l.authority||e.throw(new Error("No authority on state")),this._settings.authority!==l.authority&&e.throw(new Error("authority mismatch on settings vs. signin state")),this._settings.client_id&&this._settings.client_id!==l.client_id&&e.throw(new Error("client_id mismatch on settings vs. signin state")),e.debug("state validated"),a.userState=l.data,a.url_state=l.url_state,(r=a.scope)!=null||(a.scope=l.scope),a.error)throw e.warn("Response was error",a.error),new B(a);l.code_verifier&&!a.code&&e.throw(new Error("Expected code in response"))}async _processClaims(a,l=!1,r=!0){let e=this._logger.create("_processClaims");if(a.profile=this._claimsService.filterProtocolClaims(a.profile),l||!this._settings.loadUserInfo||!a.access_token){e.debug("not loading user info");return}e.debug("loading user info");let t=await this._userInfoService.getClaims(a.access_token);e.debug("user info claims received from user info endpoint"),r&&t.sub!==a.profile.sub&&e.throw(new Error("subject from UserInfo response does not match subject in ID Token")),a.profile=this._claimsService.mergeClaims(a.profile,this._claimsService.filterProtocolClaims(t)),e.debug("user info claims received, updated profile:",a.profile)}async _processCode(a,l,r){let e=this._logger.create("_processCode");if(a.code){e.debug("Validating code");let t=await this._tokenClient.exchangeCode({client_id:l.client_id,client_secret:l.client_secret,code:a.code,redirect_uri:l.redirect_uri,code_verifier:l.code_verifier,extraHeaders:r,...l.extraTokenParams});Object.assign(a,t)}else e.debug("No code to process")}_validateIdTokenAttributes(a,l){var r;let e=this._logger.create("_validateIdTokenAttributes");e.debug("decoding ID Token JWT");let t=da.decode((r=a.id_token)!=null?r:"");if(t.sub||e.throw(new Error("ID Token is missing a subject claim")),l){let i=da.decode(l);t.sub!==i.sub&&e.throw(new Error("sub in id_token does not match current sub")),t.auth_time&&t.auth_time!==i.auth_time&&e.throw(new Error("auth_time in id_token does not match original auth_time")),t.azp&&t.azp!==i.azp&&e.throw(new Error("azp in id_token does not match original azp")),!t.azp&&i.azp&&e.throw(new Error("azp not in id_token, but present in original id_token"))}a.profile=t}},ga=class Ma{constructor(l){this.id=l.id||R.generateUUIDv4(),this.data=l.data,l.created&&l.created>0?this.created=l.created:this.created=M.getEpochTime(),this.request_type=l.request_type,this.url_state=l.url_state}toStorageString(){return new g("State").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state})}static fromStorageString(l){return g.createStatic("State","fromStorageString"),Promise.resolve(new Ma(JSON.parse(l)))}static async clearStaleState(l,r){let e=g.createStatic("State","clearStaleState"),t=M.getEpochTime()-r,i=await l.getAllKeys();e.debug("got keys",i);for(let n=0;n<i.length;n++){let s=i[n],u=await l.get(s),o=!1;if(u)try{let b=await Ma.fromStorageString(u);e.debug("got item from key:",s,b.created),b.created<=t&&(o=!0)}catch(b){e.error("Error parsing state for key:",s,b),o=!0}else e.debug("no item in storage for key:",s),o=!0;o&&(e.debug("removed item for key:",s),l.remove(s))}}},ql=class Da extends ga{constructor(l){super(l),this.code_verifier=l.code_verifier,this.code_challenge=l.code_challenge,this.authority=l.authority,this.client_id=l.client_id,this.redirect_uri=l.redirect_uri,this.scope=l.scope,this.client_secret=l.client_secret,this.extraTokenParams=l.extraTokenParams,this.response_mode=l.response_mode,this.skipUserInfo=l.skipUserInfo}static async create(l){let r=l.code_verifier===!0?R.generateCodeVerifier():l.code_verifier||void 0,e=r?await R.generateCodeChallenge(r):void 0;return new Da({...l,code_verifier:r,code_challenge:e})}toStorageString(){return new g("SigninState").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state,code_verifier:this.code_verifier,authority:this.authority,client_id:this.client_id,redirect_uri:this.redirect_uri,scope:this.scope,client_secret:this.client_secret,extraTokenParams:this.extraTokenParams,response_mode:this.response_mode,skipUserInfo:this.skipUserInfo})}static fromStorageString(l){g.createStatic("SigninState","fromStorageString");let r=JSON.parse(l);return Da.create(r)}},Al=class Ol{constructor(l){this.url=l.url,this.state=l.state}static async create({url:l,authority:r,client_id:e,redirect_uri:t,response_type:i,scope:n,state_data:s,response_mode:u,request_type:o,client_secret:b,nonce:m,url_state:c,resource:v,skipUserInfo:k,extraQueryParams:_,extraTokenParams:h,disablePKCE:p,dpopJkt:d,omitScopeWhenRequesting:z,...E}){if(!l)throw this._logger.error("create: No url passed"),new Error("url");if(!e)throw this._logger.error("create: No client_id passed"),new Error("client_id");if(!t)throw this._logger.error("create: No redirect_uri passed"),new Error("redirect_uri");if(!i)throw this._logger.error("create: No response_type passed"),new Error("response_type");if(!n)throw this._logger.error("create: No scope passed"),new Error("scope");if(!r)throw this._logger.error("create: No authority passed"),new Error("authority");let P=await ql.create({data:s,request_type:o,url_state:c,code_verifier:!p,client_id:e,authority:r,redirect_uri:t,response_mode:u,client_secret:b,scope:n,extraTokenParams:h,skipUserInfo:k}),x=new URL(l);x.searchParams.append("client_id",e),x.searchParams.append("redirect_uri",t),x.searchParams.append("response_type",i),z||x.searchParams.append("scope",n),m&&x.searchParams.append("nonce",m),d&&x.searchParams.append("dpop_jkt",d);let I=P.id;c&&(I=`${I}${X}${c}`),x.searchParams.append("state",I),P.code_challenge&&(x.searchParams.append("code_challenge",P.code_challenge),x.searchParams.append("code_challenge_method","S256")),v&&(Array.isArray(v)?v:[v]).forEach(S=>x.searchParams.append("resource",S));for(let[C,S]of Object.entries({response_mode:u,...E,..._}))S!=null&&x.searchParams.append(C,S.toString());return new Ol({url:x.href,state:P})}};Al._logger=new g("SigninRequest");var Ar=Al,Or="openid",ja=class{constructor(a){if(this.access_token="",this.token_type="",this.profile={},this.state=a.get("state"),this.session_state=a.get("session_state"),this.state){let l=decodeURIComponent(this.state).split(X);this.state=l[0],l.length>1&&(this.url_state=l.slice(1).join(X))}this.error=a.get("error"),this.error_description=a.get("error_description"),this.error_uri=a.get("error_uri"),this.code=a.get("code")}get expires_in(){if(this.expires_at!==void 0)return this.expires_at-M.getEpochTime()}set expires_in(a){typeof a=="string"&&(a=Number(a)),a!==void 0&&a>=0&&(this.expires_at=Math.floor(a)+M.getEpochTime())}get isOpenId(){var a;return((a=this.scope)==null?void 0:a.split(" ").includes(Or))||!!this.id_token}},Hr=class{constructor({url:a,state_data:l,id_token_hint:r,post_logout_redirect_uri:e,extraQueryParams:t,request_type:i,client_id:n,url_state:s}){if(this._logger=new g("SignoutRequest"),!a)throw this._logger.error("ctor: No url passed"),new Error("url");let u=new URL(a);if(r&&u.searchParams.append("id_token_hint",r),n&&u.searchParams.append("client_id",n),e&&(u.searchParams.append("post_logout_redirect_uri",e),l||s)){this.state=new ga({data:l,request_type:i,url_state:s});let o=this.state.id;s&&(o=`${o}${X}${s}`),u.searchParams.append("state",o)}for(let[o,b]of Object.entries({...t}))b!=null&&u.searchParams.append(o,b.toString());this.url=u.href}},Nr=class{constructor(a){if(this.state=a.get("state"),this.state){let l=decodeURIComponent(this.state).split(X);this.state=l[0],l.length>1&&(this.url_state=l.slice(1).join(X))}this.error=a.get("error"),this.error_description=a.get("error_description"),this.error_uri=a.get("error_uri")}},Mr=["nbf","jti","auth_time","nonce","acr","amr","azp","at_hash"],Dr=["sub","iss","aud","exp","iat"],Lr=class{constructor(a){this._settings=a,this._logger=new g("ClaimsService")}filterProtocolClaims(a){let l={...a};if(this._settings.filterProtocolClaims){let r;Array.isArray(this._settings.filterProtocolClaims)?r=this._settings.filterProtocolClaims:r=Mr;for(let e of r)Dr.includes(e)||delete l[e]}return l}mergeClaims(a,l){let r={...a};for(let[e,t]of Object.entries(l))if(r[e]!==t)if(Array.isArray(r[e])||Array.isArray(t))if(this._settings.mergeClaimsStrategy.array=="replace")r[e]=t;else{let i=Array.isArray(r[e])?r[e]:[r[e]];for(let n of Array.isArray(t)?t:[t])i.includes(n)||i.push(n);r[e]=i}else typeof r[e]=="object"&&typeof t=="object"?r[e]=this.mergeClaims(r[e],t):r[e]=t;return r}},Hl=class{constructor(a,l){this.keys=a,this.nonce=l}},$r=class{constructor(a,l){this._logger=new g("OidcClient"),this.settings=a instanceof Na?a:new Na(a),this.metadataService=l??new Cr(this.settings),this._claimsService=new Lr(this.settings),this._validator=new qr(this.settings,this.metadataService,this._claimsService),this._tokenClient=new jl(this.settings,this.metadataService)}async createSigninRequest({state:a,request:l,request_uri:r,request_type:e,id_token_hint:t,login_hint:i,skipUserInfo:n,nonce:s,url_state:u,response_type:o=this.settings.response_type,scope:b=this.settings.scope,redirect_uri:m=this.settings.redirect_uri,prompt:c=this.settings.prompt,display:v=this.settings.display,max_age:k=this.settings.max_age,ui_locales:_=this.settings.ui_locales,acr_values:h=this.settings.acr_values,resource:p=this.settings.resource,response_mode:d=this.settings.response_mode,extraQueryParams:z=this.settings.extraQueryParams,extraTokenParams:E=this.settings.extraTokenParams,dpopJkt:P,omitScopeWhenRequesting:x=this.settings.omitScopeWhenRequesting}){let I=this._logger.create("createSigninRequest");if(o!=="code")throw new Error("Only the Authorization Code flow (with PKCE) is supported");let C=await this.metadataService.getAuthorizationEndpoint();I.debug("Received authorization endpoint",C);let S=await Ar.create({url:C,authority:this.settings.authority,client_id:this.settings.client_id,redirect_uri:m,response_type:o,scope:b,state_data:a,url_state:u,prompt:c,display:v,max_age:k,ui_locales:_,id_token_hint:t,login_hint:i,acr_values:h,dpopJkt:P,resource:p,request:l,request_uri:r,extraQueryParams:z,extraTokenParams:E,request_type:e,response_mode:d,client_secret:this.settings.client_secret,skipUserInfo:n,nonce:s,disablePKCE:this.settings.disablePKCE,omitScopeWhenRequesting:x});await this.clearStaleState();let D=S.state;return await this.settings.stateStore.set(D.id,D.toStorageString()),S}async readSigninResponseState(a,l=!1){let r=this._logger.create("readSigninResponseState"),e=new ja(Oa.readParams(a,this.settings.response_mode));if(!e.state)throw r.throw(new Error("No state in response")),null;let t=await this.settings.stateStore[l?"remove":"get"](e.state);if(!t)throw r.throw(new Error("No matching state found in storage")),null;return{state:await ql.fromStorageString(t),response:e}}async processSigninResponse(a,l,r=!0){let e=this._logger.create("processSigninResponse"),{state:t,response:i}=await this.readSigninResponseState(a,r);if(e.debug("received state from storage; validating response"),this.settings.dpop&&this.settings.dpop.store){let n=await this.getDpopProof(this.settings.dpop.store);l={...l,DPoP:n}}try{await this._validator.validateSigninResponse(i,t,l)}catch(n){if(n instanceof Ha&&this.settings.dpop){let s=await this.getDpopProof(this.settings.dpop.store,n.nonce);l.DPoP=s,await this._validator.validateSigninResponse(i,t,l)}else throw n}return i}async getDpopProof(a,l){let r,e;return(await a.getAllKeys()).includes(this.settings.client_id)?(e=await a.get(this.settings.client_id),e.nonce!==l&&l&&(e.nonce=l,await a.set(this.settings.client_id,e))):(r=await R.generateDPoPKeys(),e=new Hl(r,l),await a.set(this.settings.client_id,e)),await R.generateDPoPProof({url:await this.metadataService.getTokenEndpoint(!1),httpMethod:"POST",keyPair:e.keys,nonce:e.nonce})}async processResourceOwnerPasswordCredentials({username:a,password:l,skipUserInfo:r=!1,extraTokenParams:e={}}){let t=await this._tokenClient.exchangeCredentials({username:a,password:l,...e}),i=new ja(new URLSearchParams);return Object.assign(i,t),await this._validator.validateCredentialsResponse(i,r),i}async useRefreshToken({state:a,redirect_uri:l,resource:r,timeoutInSeconds:e,extraHeaders:t,extraTokenParams:i}){var n;let s=this._logger.create("useRefreshToken"),u;if(this.settings.refreshTokenAllowedScope===void 0)u=a.scope;else{let m=this.settings.refreshTokenAllowedScope.split(" ");u=(((n=a.scope)==null?void 0:n.split(" "))||[]).filter(v=>m.includes(v)).join(" ")}if(this.settings.dpop&&this.settings.dpop.store){let m=await this.getDpopProof(this.settings.dpop.store);t={...t,DPoP:m}}let o;try{o=await this._tokenClient.exchangeRefreshToken({refresh_token:a.refresh_token,scope:u,redirect_uri:l,resource:r,timeoutInSeconds:e,extraHeaders:t,...i})}catch(m){if(m instanceof Ha&&this.settings.dpop)t.DPoP=await this.getDpopProof(this.settings.dpop.store,m.nonce),o=await this._tokenClient.exchangeRefreshToken({refresh_token:a.refresh_token,scope:u,redirect_uri:l,resource:r,timeoutInSeconds:e,extraHeaders:t,...i});else throw m}let b=new ja(new URLSearchParams);return Object.assign(b,o),s.debug("validating response",b),await this._validator.validateRefreshResponse(b,{...a,scope:u}),b}async createSignoutRequest({state:a,id_token_hint:l,client_id:r,request_type:e,url_state:t,post_logout_redirect_uri:i=this.settings.post_logout_redirect_uri,extraQueryParams:n=this.settings.extraQueryParams}={}){let s=this._logger.create("createSignoutRequest"),u=await this.metadataService.getEndSessionEndpoint();if(!u)throw s.throw(new Error("No end session endpoint")),null;s.debug("Received end session endpoint",u),!r&&i&&!l&&(r=this.settings.client_id);let o=new Hr({url:u,id_token_hint:l,client_id:r,post_logout_redirect_uri:i,state_data:a,extraQueryParams:n,request_type:e,url_state:t});await this.clearStaleState();let b=o.state;return b&&(s.debug("Signout request has state to persist"),await this.settings.stateStore.set(b.id,b.toStorageString())),o}async readSignoutResponseState(a,l=!1){let r=this._logger.create("readSignoutResponseState"),e=new Nr(Oa.readParams(a,this.settings.response_mode));if(!e.state){if(r.debug("No state in response"),e.error)throw r.warn("Response was error:",e.error),new B(e);return{state:void 0,response:e}}let t=await this.settings.stateStore[l?"remove":"get"](e.state);if(!t)throw r.throw(new Error("No matching state found in storage")),null;return{state:await ga.fromStorageString(t),response:e}}async processSignoutResponse(a){let l=this._logger.create("processSignoutResponse"),{state:r,response:e}=await this.readSignoutResponseState(a,!0);return r?(l.debug("Received state from storage; validating response"),this._validator.validateSignoutResponse(e,r)):l.debug("No state from storage; skipping response validation"),e}clearStaleState(){return this._logger.create("clearStaleState"),ga.clearStaleState(this.settings.stateStore,this.settings.staleStateAgeInSeconds)}async revokeToken(a,l){return this._logger.create("revokeToken"),await this._tokenClient.revoke({token:a,token_type_hint:l})}},Fr=class{constructor(a){this._userManager=a,this._logger=new g("SessionMonitor"),this._start=async l=>{let r=l.session_state;if(!r)return;let e=this._logger.create("_start");if(l.profile?(this._sub=l.profile.sub,e.debug("session_state",r,", sub",this._sub)):(this._sub=void 0,e.debug("session_state",r,", anonymous user")),this._checkSessionIFrame){this._checkSessionIFrame.start(r);return}try{let t=await this._userManager.metadataService.getCheckSessionIframe();if(t){e.debug("initializing check session iframe");let i=this._userManager.settings.client_id,n=this._userManager.settings.checkSessionIntervalInSeconds,s=this._userManager.settings.stopCheckSessionOnError,u=new Pr(this._callback,i,t,n,s);await u.load(),this._checkSessionIFrame=u,u.start(r)}else e.warn("no check session iframe found in the metadata")}catch(t){e.error("Error from getCheckSessionIframe:",t instanceof Error?t.message:t)}},this._stop=()=>{let l=this._logger.create("_stop");if(this._sub=void 0,this._checkSessionIFrame&&this._checkSessionIFrame.stop(),this._userManager.settings.monitorAnonymousSession){let r=setInterval(async()=>{clearInterval(r);try{let e=await this._userManager.querySessionStatus();if(e){let t={session_state:e.session_state,profile:e.sub?{sub:e.sub}:null};this._start(t)}}catch(e){l.error("error from querySessionStatus",e instanceof Error?e.message:e)}},1e3)}},this._callback=async()=>{let l=this._logger.create("_callback");try{let r=await this._userManager.querySessionStatus(),e=!0;r&&this._checkSessionIFrame?r.sub===this._sub?(e=!1,this._checkSessionIFrame.start(r.session_state),l.debug("same sub still logged in at OP, session state has changed, restarting check session iframe; session_state",r.session_state),await this._userManager.events._raiseUserSessionChanged()):l.debug("different subject signed into OP",r.sub):l.debug("subject no longer signed into OP"),e?this._sub?await this._userManager.events._raiseUserSignedOut():await this._userManager.events._raiseUserSignedIn():l.debug("no change in session detected, no event to raise")}catch(r){this._sub&&(l.debug("Error calling queryCurrentSigninSession; raising signed out event",r),await this._userManager.events._raiseUserSignedOut())}},a||this._logger.throw(new Error("No user manager passed")),this._userManager.events.addUserLoaded(this._start),this._userManager.events.addUserUnloaded(this._stop),this._init().catch(l=>{this._logger.error(l)})}async _init(){this._logger.create("_init");let a=await this._userManager.getUser();if(a)this._start(a);else if(this._userManager.settings.monitorAnonymousSession){let l=await this._userManager.querySessionStatus();if(l){let r={session_state:l.session_state,profile:l.sub?{sub:l.sub}:null};this._start(r)}}}},qa=class Nl{constructor(l){var r;this.id_token=l.id_token,this.session_state=(r=l.session_state)!=null?r:null,this.access_token=l.access_token,this.refresh_token=l.refresh_token,this.token_type=l.token_type,this.scope=l.scope,this.profile=l.profile,this.expires_at=l.expires_at,this.state=l.userState,this.url_state=l.url_state}get expires_in(){if(this.expires_at!==void 0)return this.expires_at-M.getEpochTime()}set expires_in(l){l!==void 0&&(this.expires_at=Math.floor(l)+M.getEpochTime())}get expired(){let l=this.expires_in;if(l!==void 0)return l<=0}get scopes(){var l,r;return(r=(l=this.scope)==null?void 0:l.split(" "))!=null?r:[]}toStorageString(){return new g("User").create("toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})}static fromStorageString(l){return g.createStatic("User","fromStorageString"),new Nl(JSON.parse(l))}},Pl="oidc-client",Ml=class{constructor(){this._abort=new $("Window navigation aborted"),this._disposeHandlers=new Set,this._window=null}async navigate(a){let l=this._logger.create("navigate");if(!this._window)throw new Error("Attempted to navigate on a disposed window");l.debug("setting URL in window"),this._window.location.replace(a.url);let{url:r,keepOpen:e}=await new Promise((t,i)=>{let n=u=>{var o;let b=u.data,m=(o=a.scriptOrigin)!=null?o:window.location.origin;if(!(u.origin!==m||b?.source!==Pl)){try{let c=Oa.readParams(b.url,a.response_mode).get("state");if(c||l.warn("no state found in response url"),u.source!==this._window&&c!==a.state)return}catch{this._dispose(),i(new Error("Invalid response from window"))}t(b)}};window.addEventListener("message",n,!1),this._disposeHandlers.add(()=>window.removeEventListener("message",n,!1));let s=new BroadcastChannel(`oidc-client-popup-${a.state}`);s.addEventListener("message",n,!1),this._disposeHandlers.add(()=>s.close()),this._disposeHandlers.add(this._abort.addHandler(u=>{this._dispose(),i(u)}))});return l.debug("got response from window"),this._dispose(),e||this.close(),{url:r}}_dispose(){this._logger.create("_dispose");for(let a of this._disposeHandlers)a();this._disposeHandlers.clear()}static _notifyParent(a,l,r=!1,e=window.location.origin){let t={source:Pl,url:l,keepOpen:r},i=new g("_notifyParent");if(a)i.debug("With parent. Using parent.postMessage."),a.postMessage(t,e);else{i.debug("No parent. Using BroadcastChannel.");let n=new URL(l).searchParams.get("state");if(!n)throw new Error("No parent and no state in URL. Can't complete notification.");let s=new BroadcastChannel(`oidc-client-popup-${n}`);s.postMessage(t),s.close()}}},Dl={location:!1,toolbar:!1,height:640,closePopupWindowAfterInSeconds:-1},Ll="_blank",Wr=60,Kr=2,$l=10,Jr=class extends Na{constructor(a){let{popup_redirect_uri:l=a.redirect_uri,popup_post_logout_redirect_uri:r=a.post_logout_redirect_uri,popupWindowFeatures:e=Dl,popupWindowTarget:t=Ll,redirectMethod:i="assign",redirectTarget:n="self",iframeNotifyParentOrigin:s=a.iframeNotifyParentOrigin,iframeScriptOrigin:u=a.iframeScriptOrigin,requestTimeoutInSeconds:o,silent_redirect_uri:b=a.redirect_uri,silentRequestTimeoutInSeconds:m,automaticSilentRenew:c=!0,validateSubOnSilentRenew:v=!0,includeIdTokenInSilentRenew:k=!1,monitorSession:_=!1,monitorAnonymousSession:h=!1,checkSessionIntervalInSeconds:p=Kr,query_status_response_type:d="code",stopCheckSessionOnError:z=!0,revokeTokenTypes:E=["access_token","refresh_token"],revokeTokensOnSignout:P=!1,includeIdTokenInSilentSignout:x=!1,accessTokenExpiringNotificationTimeInSeconds:I=Wr,userStore:C}=a;if(super(a),this.popup_redirect_uri=l,this.popup_post_logout_redirect_uri=r,this.popupWindowFeatures=e,this.popupWindowTarget=t,this.redirectMethod=i,this.redirectTarget=n,this.iframeNotifyParentOrigin=s,this.iframeScriptOrigin=u,this.silent_redirect_uri=b,this.silentRequestTimeoutInSeconds=m||o||$l,this.automaticSilentRenew=c,this.validateSubOnSilentRenew=v,this.includeIdTokenInSilentRenew=k,this.monitorSession=_,this.monitorAnonymousSession=h,this.checkSessionIntervalInSeconds=p,this.stopCheckSessionOnError=z,this.query_status_response_type=d,this.revokeTokenTypes=E,this.revokeTokensOnSignout=P,this.includeIdTokenInSilentSignout=x,this.accessTokenExpiringNotificationTimeInSeconds=I,C)this.userStore=C;else{let S=typeof window<"u"?window.sessionStorage:new Il;this.userStore=new Ul({store:S})}}},Cl=class Fl extends Ml{constructor({silentRequestTimeoutInSeconds:l=$l}){super(),this._logger=new g("IFrameWindow"),this._timeoutInSeconds=l,this._frame=Fl.createHiddenIframe(),this._window=this._frame.contentWindow}static createHiddenIframe(){let l=window.document.createElement("iframe");return l.style.visibility="hidden",l.style.position="fixed",l.style.left="-1000px",l.style.top="0",l.width="0",l.height="0",window.document.body.appendChild(l),l}async navigate(l){this._logger.debug("navigate: Using timeout of:",this._timeoutInSeconds);let r=setTimeout(()=>void this._abort.raise(new La("IFrame timed out without a response")),this._timeoutInSeconds*1e3);return this._disposeHandlers.add(()=>clearTimeout(r)),await super.navigate(l)}close(){var l;this._frame&&(this._frame.parentNode&&(this._frame.addEventListener("load",r=>{var e;let t=r.target;(e=t.parentNode)==null||e.removeChild(t),this._abort.raise(new Error("IFrame removed from DOM"))},!0),(l=this._frame.contentWindow)==null||l.location.replace("about:blank")),this._frame=null),this._window=null}static notifyParent(l,r){return super._notifyParent(window.parent,l,!1,r)}},Br=class{constructor(a){this._settings=a,this._logger=new g("IFrameNavigator")}async prepare({silentRequestTimeoutInSeconds:a=this._settings.silentRequestTimeoutInSeconds}){return new Cl({silentRequestTimeoutInSeconds:a})}async callback(a){this._logger.create("callback"),Cl.notifyParent(a,this._settings.iframeNotifyParentOrigin)}},Vr=500,Gr=1e3,Rl=class extends Ml{constructor({popupWindowTarget:a=Ll,popupWindowFeatures:l={},popupSignal:r}){super(),this._logger=new g("PopupWindow");let e=El.center({...Dl,...l});this._window=window.open(void 0,a,El.serialize(e)),r&&r.addEventListener("abort",()=>{var t;this._abort.raise(new Error((t=r.reason)!=null?t:"Popup aborted"))}),l.closePopupWindowAfterInSeconds&&l.closePopupWindowAfterInSeconds>0&&setTimeout(()=>{if(!this._window||typeof this._window.closed!="boolean"||this._window.closed){this._abort.raise(new Error("Popup blocked by user"));return}this.close()},l.closePopupWindowAfterInSeconds*Gr)}async navigate(a){var l;(l=this._window)==null||l.focus();let r=setInterval(()=>{(!this._window||this._window.closed)&&(this._logger.debug("Popup closed by user or isolated by redirect"),e(),this._disposeHandlers.delete(e))},Vr),e=()=>clearInterval(r);return this._disposeHandlers.add(e),await super.navigate(a)}close(){this._window&&(this._window.closed||(this._window.close(),this._abort.raise(new Error("Popup closed")))),this._window=null}static notifyOpener(a,l){super._notifyParent(window.opener,a,l),!l&&!window.opener&&window.close()}},Yr=class{constructor(a){this._settings=a,this._logger=new g("PopupNavigator")}async prepare({popupWindowFeatures:a=this._settings.popupWindowFeatures,popupWindowTarget:l=this._settings.popupWindowTarget,popupSignal:r}){return new Rl({popupWindowFeatures:a,popupWindowTarget:l,popupSignal:r})}async callback(a,{keepOpen:l=!1}){this._logger.create("callback"),Rl.notifyOpener(a,l)}},Qr=class{constructor(a){this._settings=a,this._logger=new g("RedirectNavigator")}async prepare({redirectMethod:a=this._settings.redirectMethod,redirectTarget:l=this._settings.redirectTarget}){var r;this._logger.create("prepare");let e=window.self;l==="top"&&(e=(r=window.top)!=null?r:window.self);let t=e.location[a].bind(e.location),i;return{navigate:async n=>{this._logger.create("navigate");let s=new Promise((u,o)=>{i=o});return t(n.url),await s},close:()=>{this._logger.create("close"),i?.(new Error("Redirect aborted")),e.stop()}}}async callback(){}},Xr=class extends Er{constructor(a){super({expiringNotificationTimeInSeconds:a.accessTokenExpiringNotificationTimeInSeconds}),this._logger=new g("UserManagerEvents"),this._userLoaded=new $("User loaded"),this._userUnloaded=new $("User unloaded"),this._silentRenewError=new $("Silent renew error"),this._userSignedIn=new $("User signed in"),this._userSignedOut=new $("User signed out"),this._userSessionChanged=new $("User session changed")}async load(a,l=!0){await super.load(a),l&&await this._userLoaded.raise(a)}async unload(){await super.unload(),await this._userUnloaded.raise()}addUserLoaded(a){return this._userLoaded.addHandler(a)}removeUserLoaded(a){return this._userLoaded.removeHandler(a)}addUserUnloaded(a){return this._userUnloaded.addHandler(a)}removeUserUnloaded(a){return this._userUnloaded.removeHandler(a)}addSilentRenewError(a){return this._silentRenewError.addHandler(a)}removeSilentRenewError(a){return this._silentRenewError.removeHandler(a)}async _raiseSilentRenewError(a){await this._silentRenewError.raise(a)}addUserSignedIn(a){return this._userSignedIn.addHandler(a)}removeUserSignedIn(a){this._userSignedIn.removeHandler(a)}async _raiseUserSignedIn(){await this._userSignedIn.raise()}addUserSignedOut(a){return this._userSignedOut.addHandler(a)}removeUserSignedOut(a){this._userSignedOut.removeHandler(a)}async _raiseUserSignedOut(){await this._userSignedOut.raise()}addUserSessionChanged(a){return this._userSessionChanged.addHandler(a)}removeUserSessionChanged(a){this._userSessionChanged.removeHandler(a)}async _raiseUserSessionChanged(){await this._userSessionChanged.raise()}},Zr=class{constructor(a){this._userManager=a,this._logger=new g("SilentRenewService"),this._isStarted=!1,this._retryTimer=new M("Retry Silent Renew"),this._tokenExpiring=async()=>{let l=this._logger.create("_tokenExpiring");try{await this._userManager.signinSilent(),l.debug("silent token renewal successful")}catch(r){if(r instanceof La){l.warn("ErrorTimeout from signinSilent:",r,"retry in 5s"),this._retryTimer.init(5);return}l.error("Error from signinSilent:",r),await this._userManager.events._raiseSilentRenewError(r)}}}async start(){let a=this._logger.create("start");if(!this._isStarted){this._isStarted=!0,this._userManager.events.addAccessTokenExpiring(this._tokenExpiring),this._retryTimer.addHandler(this._tokenExpiring);try{await this._userManager.getUser()}catch(l){a.error("getUser error",l)}}}stop(){this._isStarted&&(this._retryTimer.cancel(),this._retryTimer.removeHandler(this._tokenExpiring),this._userManager.events.removeAccessTokenExpiring(this._tokenExpiring),this._isStarted=!1)}},ae=class{constructor(a){this.refresh_token=a.refresh_token,this.id_token=a.id_token,this.session_state=a.session_state,this.scope=a.scope,this.profile=a.profile,this.data=a.state}},Le=class{constructor(a,l,r,e){this._logger=new g("UserManager"),this.settings=new Jr(a),this._client=new $r(a),this._redirectNavigator=l??new Qr(this.settings),this._popupNavigator=r??new Yr(this.settings),this._iframeNavigator=e??new Br(this.settings),this._events=new Xr(this.settings),this._silentRenewService=new Zr(this),this.settings.automaticSilentRenew&&this.startSilentRenew(),this._sessionMonitor=null,this.settings.monitorSession&&(this._sessionMonitor=new Fr(this))}get events(){return this._events}get metadataService(){return this._client.metadataService}async getUser(a=!1){let l=this._logger.create("getUser"),r=await this._loadUser();return r?(l.info("user loaded"),await this._events.load(r,a),r):(l.info("user not found in storage"),null)}async removeUser(){let a=this._logger.create("removeUser");await this.storeUser(null),a.info("user removed from storage"),await this._events.unload()}async signinRedirect(a={}){var l;this._logger.create("signinRedirect");let{redirectMethod:r,...e}=a,t;(l=this.settings.dpop)!=null&&l.bind_authorization_code&&(t=await this.generateDPoPJkt(this.settings.dpop));let i=await this._redirectNavigator.prepare({redirectMethod:r});await this._signinStart({request_type:"si:r",dpopJkt:t,...e},i)}async signinRedirectCallback(a=window.location.href){let l=this._logger.create("signinRedirectCallback"),r=await this._signinEnd(a);return r.profile&&r.profile.sub?l.info("success, signed in subject",r.profile.sub):l.info("no subject"),r}async signinResourceOwnerCredentials({username:a,password:l,skipUserInfo:r=!1}){let e=this._logger.create("signinResourceOwnerCredential"),t=await this._client.processResourceOwnerPasswordCredentials({username:a,password:l,skipUserInfo:r,extraTokenParams:this.settings.extraTokenParams});e.debug("got signin response");let i=await this._buildUser(t);return i.profile&&i.profile.sub?e.info("success, signed in subject",i.profile.sub):e.info("no subject"),i}async signinPopup(a={}){var l;let r=this._logger.create("signinPopup"),e;(l=this.settings.dpop)!=null&&l.bind_authorization_code&&(e=await this.generateDPoPJkt(this.settings.dpop));let{popupWindowFeatures:t,popupWindowTarget:i,popupSignal:n,...s}=a,u=this.settings.popup_redirect_uri;u||r.throw(new Error("No popup_redirect_uri configured"));let o=await this._popupNavigator.prepare({popupWindowFeatures:t,popupWindowTarget:i,popupSignal:n}),b=await this._signin({request_type:"si:p",redirect_uri:u,display:"popup",dpopJkt:e,...s},o);return b&&(b.profile&&b.profile.sub?r.info("success, signed in subject",b.profile.sub):r.info("no subject")),b}async signinPopupCallback(a=window.location.href,l=!1){let r=this._logger.create("signinPopupCallback");await this._popupNavigator.callback(a,{keepOpen:l}),r.info("success")}async signinSilent(a={}){var l,r;let e=this._logger.create("signinSilent"),{silentRequestTimeoutInSeconds:t,...i}=a,n=await this._loadUser();if(n?.refresh_token){e.debug("using refresh token");let m=new ae(n);return await this._useRefreshToken({state:m,redirect_uri:i.redirect_uri,resource:i.resource,extraTokenParams:i.extraTokenParams,timeoutInSeconds:t})}let s;(l=this.settings.dpop)!=null&&l.bind_authorization_code&&(s=await this.generateDPoPJkt(this.settings.dpop));let u=this.settings.silent_redirect_uri;u||e.throw(new Error("No silent_redirect_uri configured"));let o;n&&this.settings.validateSubOnSilentRenew&&(e.debug("subject prior to silent renew:",n.profile.sub),o=n.profile.sub);let b=await this._iframeNavigator.prepare({silentRequestTimeoutInSeconds:t});return n=await this._signin({request_type:"si:s",redirect_uri:u,prompt:"none",id_token_hint:this.settings.includeIdTokenInSilentRenew?n?.id_token:void 0,dpopJkt:s,...i},b,o),n&&((r=n.profile)!=null&&r.sub?e.info("success, signed in subject",n.profile.sub):e.info("no subject")),n}async _useRefreshToken(a){let l=await this._client.useRefreshToken({timeoutInSeconds:this.settings.silentRequestTimeoutInSeconds,...a}),r=new qa({...a.state,...l});return await this.storeUser(r),await this._events.load(r),r}async signinSilentCallback(a=window.location.href){let l=this._logger.create("signinSilentCallback");await this._iframeNavigator.callback(a),l.info("success")}async signinCallback(a=window.location.href){let{state:l}=await this._client.readSigninResponseState(a);switch(l.request_type){case"si:r":return await this.signinRedirectCallback(a);case"si:p":await this.signinPopupCallback(a);break;case"si:s":await this.signinSilentCallback(a);break;default:throw new Error("invalid response_type in state")}}async signoutCallback(a=window.location.href,l=!1){let{state:r}=await this._client.readSignoutResponseState(a);if(r)switch(r.request_type){case"so:r":return await this.signoutRedirectCallback(a);case"so:p":await this.signoutPopupCallback(a,l);break;case"so:s":await this.signoutSilentCallback(a);break;default:throw new Error("invalid response_type in state")}}async querySessionStatus(a={}){let l=this._logger.create("querySessionStatus"),{silentRequestTimeoutInSeconds:r,...e}=a,t=this.settings.silent_redirect_uri;t||l.throw(new Error("No silent_redirect_uri configured"));let i=await this._loadUser(),n=await this._iframeNavigator.prepare({silentRequestTimeoutInSeconds:r}),s=await this._signinStart({request_type:"si:s",redirect_uri:t,prompt:"none",id_token_hint:this.settings.includeIdTokenInSilentRenew?i?.id_token:void 0,response_type:this.settings.query_status_response_type,scope:"openid",skipUserInfo:!0,...e},n);try{let u={},o=await this._client.processSigninResponse(s.url,u);return l.debug("got signin response"),o.session_state&&o.profile.sub?(l.info("success for subject",o.profile.sub),{session_state:o.session_state,sub:o.profile.sub}):(l.info("success, user not authenticated"),null)}catch(u){if(this.settings.monitorAnonymousSession&&u instanceof B)switch(u.error){case"login_required":case"consent_required":case"interaction_required":case"account_selection_required":return l.info("success for anonymous user"),{session_state:u.session_state}}throw u}}async _signin(a,l,r){let e=await this._signinStart(a,l);return await this._signinEnd(e.url,r)}async _signinStart(a,l){let r=this._logger.create("_signinStart");try{let e=await this._client.createSigninRequest(a);return r.debug("got signin request"),await l.navigate({url:e.url,state:e.state.id,response_mode:e.state.response_mode,scriptOrigin:this.settings.iframeScriptOrigin})}catch(e){throw r.debug("error after preparing navigator, closing navigator window"),l.close(),e}}async _signinEnd(a,l){let r=this._logger.create("_signinEnd"),e={},t=await this._client.processSigninResponse(a,e);return r.debug("got signin response"),await this._buildUser(t,l)}async _buildUser(a,l){let r=this._logger.create("_buildUser"),e=new qa(a);if(l){if(l!==e.profile.sub)throw r.debug("current user does not match user returned from signin. sub from signin:",e.profile.sub),new B({...a,error:"login_required"});r.debug("current user matches user returned from signin")}return await this.storeUser(e),r.debug("user stored"),await this._events.load(e),e}async signoutRedirect(a={}){let l=this._logger.create("signoutRedirect"),{redirectMethod:r,...e}=a,t=await this._redirectNavigator.prepare({redirectMethod:r});await this._signoutStart({request_type:"so:r",post_logout_redirect_uri:this.settings.post_logout_redirect_uri,...e},t),l.info("success")}async signoutRedirectCallback(a=window.location.href){let l=this._logger.create("signoutRedirectCallback"),r=await this._signoutEnd(a);return l.info("success"),r}async signoutPopup(a={}){let l=this._logger.create("signoutPopup"),{popupWindowFeatures:r,popupWindowTarget:e,popupSignal:t,...i}=a,n=this.settings.popup_post_logout_redirect_uri,s=await this._popupNavigator.prepare({popupWindowFeatures:r,popupWindowTarget:e,popupSignal:t});await this._signout({request_type:"so:p",post_logout_redirect_uri:n,state:n==null?void 0:{},...i},s),l.info("success")}async signoutPopupCallback(a=window.location.href,l=!1){let r=this._logger.create("signoutPopupCallback");await this._popupNavigator.callback(a,{keepOpen:l}),r.info("success")}async _signout(a,l){let r=await this._signoutStart(a,l);return await this._signoutEnd(r.url)}async _signoutStart(a={},l){var r;let e=this._logger.create("_signoutStart");try{let t=await this._loadUser();e.debug("loaded current user from storage"),this.settings.revokeTokensOnSignout&&await this._revokeInternal(t);let i=a.id_token_hint||t&&t.id_token;i&&(e.debug("setting id_token_hint in signout request"),a.id_token_hint=i),await this.removeUser(),e.debug("user removed, creating signout request");let n=await this._client.createSignoutRequest(a);return e.debug("got signout request"),await l.navigate({url:n.url,state:(r=n.state)==null?void 0:r.id,scriptOrigin:this.settings.iframeScriptOrigin})}catch(t){throw e.debug("error after preparing navigator, closing navigator window"),l.close(),t}}async _signoutEnd(a){let l=this._logger.create("_signoutEnd"),r=await this._client.processSignoutResponse(a);return l.debug("got signout response"),r}async signoutSilent(a={}){var l;let r=this._logger.create("signoutSilent"),{silentRequestTimeoutInSeconds:e,...t}=a,i=this.settings.includeIdTokenInSilentSignout?(l=await this._loadUser())==null?void 0:l.id_token:void 0,n=this.settings.popup_post_logout_redirect_uri,s=await this._iframeNavigator.prepare({silentRequestTimeoutInSeconds:e});await this._signout({request_type:"so:s",post_logout_redirect_uri:n,id_token_hint:i,...t},s),r.info("success")}async signoutSilentCallback(a=window.location.href){let l=this._logger.create("signoutSilentCallback");await this._iframeNavigator.callback(a),l.info("success")}async revokeTokens(a){let l=await this._loadUser();await this._revokeInternal(l,a)}async _revokeInternal(a,l=this.settings.revokeTokenTypes){let r=this._logger.create("_revokeInternal");if(!a)return;let e=l.filter(t=>typeof a[t]=="string");if(!e.length){r.debug("no need to revoke due to no token(s)");return}for(let t of e)await this._client.revokeToken(a[t],t),r.info(`${t} revoked successfully`),t!=="access_token"&&(a[t]=null);await this.storeUser(a),r.debug("user stored"),await this._events.load(a)}startSilentRenew(){this._logger.create("startSilentRenew"),this._silentRenewService.start()}stopSilentRenew(){this._silentRenewService.stop()}get _userStoreKey(){return`user:${this.settings.authority}:${this.settings.client_id}`}async _loadUser(){let a=this._logger.create("_loadUser"),l=await this.settings.userStore.get(this._userStoreKey);return l?(a.debug("user storageString loaded"),qa.fromStorageString(l)):(a.debug("no user storageString"),null)}async storeUser(a){let l=this._logger.create("storeUser");if(a){l.debug("storing user");let r=a.toStorageString();await this.settings.userStore.set(this._userStoreKey,r)}else this._logger.debug("removing user"),await this.settings.userStore.remove(this._userStoreKey),this.settings.dpop&&await this.settings.dpop.store.remove(this.settings.client_id)}async clearStaleState(){await this._client.clearStaleState()}async dpopProof(a,l,r,e){var t,i;let n=await((i=(t=this.settings.dpop)==null?void 0:t.store)==null?void 0:i.get(this.settings.client_id));if(n)return await R.generateDPoPProof({url:a,accessToken:l?.access_token,httpMethod:r,keyPair:n.keys,nonce:e})}async generateDPoPJkt(a){let l=await a.store.get(this.settings.client_id);if(!l){let r=await R.generateDPoPKeys();l=new Hl(r),await a.store.set(this.settings.client_id,l)}return await R.generateDPoPJkt(l.keys)}},le="3.3.0",$e=le,Fe=class{constructor(){this._dbName="oidc",this._storeName="dpop"}async set(a,l){await(await this.createStore(this._dbName,this._storeName))("readwrite",e=>(e.put(l,a),this.promisifyRequest(e.transaction)))}async get(a){return await(await this.createStore(this._dbName,this._storeName))("readonly",r=>this.promisifyRequest(r.get(a)))}async remove(a){let l=await this.get(a);return await(await this.createStore(this._dbName,this._storeName))("readwrite",e=>this.promisifyRequest(e.delete(a))),l}async getAllKeys(){return await(await this.createStore(this._dbName,this._storeName))("readonly",l=>this.promisifyRequest(l.getAllKeys()))}promisifyRequest(a){return new Promise((l,r)=>{a.oncomplete=a.onsuccess=()=>l(a.result),a.onabort=a.onerror=()=>r(a.error)})}async createStore(a,l){let r=indexedDB.open(a);r.onupgradeneeded=()=>r.result.createObjectStore(l);let e=await this.promisifyRequest(r);return async(t,i)=>{let s=e.transaction(l,t).objectStore(l);return await i(s)}}};function Wl(a,l){if(a instanceof RegExp)return{keys:!1,pattern:a};var r,e,t,i,n=[],s="",u=a.split("/");for(u[0]||u.shift();t=u.shift();)r=t[0],r==="*"?(n.push(r),s+=t[1]==="?"?"(?:/(.*))?":"/(.*)"):r===":"?(e=t.indexOf("?",1),i=t.indexOf(".",1),n.push(t.substring(1,~e?e:~i?i:t.length)),s+=~e&&!~i?"(?:/([^/]+?))?":"/([^/]+?)",~i&&(s+=(~e?"?":"")+"\\"+t.substring(i))):s+="/"+t;return{keys:n,pattern:new RegExp("^"+s+(l?"(?=$|/)":"/?$"),"i")}}var re=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Fa(a,l){return a===l&&(a!==0||1/a===1/l)||a!==a&&l!==l}function pa(a,l,r){r&&!re&&(l=r);let e=l(),[{_instance:t},i]=Ta({_instance:{_value:e,_getSnapshot:l}});return Q(()=>{t._value=e,t._getSnapshot=l,Fa(t._value,l())||i({_instance:t})},[a,e,l]),_l(()=>(Fa(t._value,t._getSnapshot())||i({_instance:t}),a(()=>{Fa(t._value,t._getSnapshot())||i({_instance:t})})),[a]),e}var ia=a=>{let l=ta([a,(...r)=>l[0](...r)]).current;return Q(()=>{l[0]=a}),l[1]};var ee="popstate",Wa="pushState",Ka="replaceState",te="hashchange",Kl=[ee,Wa,Ka,te],ie=a=>{for(let l of Kl)addEventListener(l,a);return()=>{for(let l of Kl)removeEventListener(l,a)}},Vl=(a,l)=>pa(ie,a,l),ne=()=>location.search,Gl=({ssrSearch:a=""}={})=>Vl(ne,()=>a),Jl=()=>location.pathname,se=({ssrPath:a}={})=>Vl(Jl,a?()=>a:Jl);var oe=(a,{replace:l=!1,state:r=null}={})=>history[l?Ka:Wa](r,"",a),Yl=(a={})=>[se(a),oe],Bl=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[Bl]>"u"){for(let a of[Wa,Ka]){let l=history[a];history[a]=function(){let r=l.apply(this,arguments),e=new Event(a);return e.arguments=arguments,dispatchEvent(e),r}}Object.defineProperty(window,Bl,{value:!0})}var me=(a,l)=>l.toLowerCase().indexOf(a.toLowerCase())?"~"+l:l.slice(a.length)||"/",Xl=(a="")=>a==="/"?"":a,ue=(a,l)=>a[0]==="~"?a.slice(1):Xl(l)+a,be=(a="",l)=>me(Ja(Xl(a)),Ja(l)),ce=a=>a[0]==="?"?a.slice(1):a,Ja=a=>{try{return decodeURI(a)}catch{return a}},ve=a=>Ja(ce(a)),Zl={hook:Yl,searchHook:Gl,parser:Wl,base:"",ssrPath:void 0,ssrSearch:void 0,ssrContext:void 0,hrefs:a=>a},ar=Pa(Zl),F=()=>Ia(ar),lr={},rr=Pa(lr),he=()=>Ia(rr),na=a=>{let[l,r]=a.hook(a);return[be(a.base,l),ia((e,t)=>r(ue(e,a.base),t))]},er=()=>na(F()),de=()=>{let a=F();return ve(a.searchHook(a))},Ba=(a,l,r,e)=>{let{pattern:t,keys:i}=l instanceof RegExp?{keys:!1,pattern:l}:a(l||"*",e),n=t.exec(r)||[],[s,...u]=n;return s!==void 0?[!0,(()=>{let o=i!==!1?Object.fromEntries(i.map((m,c)=>[m,u[c]])):n.groups,b={...u};return o&&Object.assign(b,o),b})(),...e?[s]:[]]:[!1,null]},Dt=a=>Ba(F().parser,a,er()[0]),ge=({children:a,...l})=>{let r=F(),e=l.hook?Zl:r,t=e,[i,n]=l.ssrPath?.split("?")??[];n&&(l.ssrSearch=n,l.ssrPath=i),l.hrefs=l.hrefs??l.hook?.hrefs;let s=ta({}),u=s.current,o=u;for(let b in e){let m=b==="base"?e[b]+(l[b]||""):l[b]||e[b];u===o&&m!==o[b]&&(s.current=o={...o}),o[b]=m,(m!==e[b]||m!==t[b])&&(t=o)}return j(ar.Provider,{value:t,children:a})},Ql=({children:a,component:l},r)=>l?j(l,{params:r}):typeof a=="function"?a(r):a,pe=a=>{let l=ta(lr),r=l.current;return l.current=Object.keys(a).length!==Object.keys(r).length||Object.entries(a).some(([e,t])=>t!==r[e])?a:r};function Lt(){let[a,l]=er(),r=de(),e=ca(()=>new URLSearchParams(r),[r]),t=e,i=ia((n,s)=>{t=new URLSearchParams(typeof n=="function"?n(t):n),l(a+"?"+t,s)});return[e,i]}var $t=({path:a,nest:l,match:r,...e})=>{let t=F(),[i]=na(t),[n,s,u]=r??Ba(t.parser,a,i,l),o=pe({...he(),...s});if(!n)return null;let b=u?j(ge,{base:u},Ql(e,o)):Ql(e,o);return j(rr.Provider,{value:o,children:b})},Ft=(a,l)=>{let r=F(),[e,t]=na(r),{to:i="",href:n=i,onClick:s,asChild:u,children:o,className:b,replace:m,state:c,...v}=a,k=ia(h=>{h.ctrlKey||h.metaKey||h.altKey||h.shiftKey||h.button!==0||(s?.(h),h.defaultPrevented||(h.preventDefault(),t(n,a)))}),_=r.hrefs(n[0]==="~"?n.slice(1):r.base+n,r);return u&&ua(o)?Ea(o,{onClick:k,href:_}):j("a",{...v,onClick:k,href:_,className:b?.call?b(e===n):b,children:o,ref:l})},tr=a=>Array.isArray(a)?a.flatMap(l=>tr(l&&l.type===G?l.props.children:l)):[a],Wt=({children:a,location:l})=>{let r=F(),[e]=na(r);for(let t of tr(a)){let i=0;if(ua(t)&&(i=Ba(r.parser,t.props.path,l||e,t.props.nest))[0])return Ea(t,{match:i})}return null},Kt=a=>{let{to:l,href:r=l}=a,e=F(),[,t]=na(e),i=ia(()=>t(l||r,a)),{ssrContext:n}=e;return Q(()=>{i()},[]),n&&(n.redirectTo=l),null};var sa={v:[]},ir=()=>sa.v.forEach(a=>a()),ke=a=>(sa.v.push(a)===1&&addEventListener("hashchange",ir),()=>{sa.v=sa.v.filter(l=>l!==a),sa.v.length||removeEventListener("hashchange",ir)}),fe=()=>"/"+location.hash.replace(/^#?\/?/,""),we=(a,{state:l=null,replace:r=!1}={})=>{let[e,t]=a.replace(/^#?\/?/,"").split("?"),i=location.pathname+(t?`?${t}`:location.search)+`#/${e}`,n=location.href,s=new URL(i,location.origin).href;r?history.replaceState(l,"",i):history.pushState(l,"",i);let u=typeof HashChangeEvent<"u"?new HashChangeEvent("hashchange",{oldURL:n,newURL:s}):new Event("hashchange",{detail:{oldURL:n,newURL:s}});dispatchEvent(u)},xe=({ssrPath:a="/"}={})=>[pa(ke,fe,()=>a),we];xe.hrefs=a=>"#"+a;export{Er as AccessTokenEvents,Pr as CheckSessionIFrame,aa as Component,Hl as DPoPState,B as ErrorResponse,La as ErrorTimeout,G as Fragment,Il as InMemoryWebStorage,Fe as IndexedDbDPoPStore,Ft as Link,ha as Log,g as Logger,Cr as MetadataService,$r as OidcClient,Na as OidcClientSettingsStore,Kt as Redirect,$t as Route,ge as Router,Fr as SessionMonitor,ja as SigninResponse,ql as SigninState,Nr as SignoutResponse,ga as State,Wt as Switch,qa as User,Le as UserManager,Jr as UserManagerSettingsStore,$e as Version,Ul as WebStorageStateStore,Ea as cloneElement,Pa as createContext,j as createElement,ye as createRef,j as h,Re as html,kr as hydrate,ua as isValidElement,Ba as matchRoute,we as navigate,w as options,ul as render,hr as toChildArray,qe as useCallback,Ia as useContext,Ae as useDebugValue,_l as useEffect,Oe as useErrorBoundary,xe as useHashLocation,He as useId,je as useImperativeHandle,Q as useLayoutEffect,er as useLocation,ca as useMemo,he as useParams,fr as useReducer,ta as useRef,Dt as useRoute,F as useRouter,de as useSearch,Lt as useSearchParams,Ta as useState};
//# sourceMappingURL=deps.mjs.map
